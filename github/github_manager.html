<!doctype html>
<html lang="cs">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Lok√°ln√≠ spr√°vce GitHub repozit√°≈ô≈Ø p≈ôes Personal Access Token."
    />
    <link
      rel="icon"
      data-uri="data:image/svg+xml,"
      href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Crect width='32' height='32' rx='8' fill='%230e0f11'/%3E%3Ctext x='16' y='22' text-anchor='middle' font-size='20'%3EüìÅ%3C/text%3E%3C/svg%3E"
    />
    <title>GitHub Manager</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@300;400;500;600&family=Syne:wght@400;500;700;800&display=swap");

      :root {
        --bg: #0e0f11;
        --surface: #161719;
        --surface2: #1e2025;
        --border: #2a2d34;
        --text: #d4d6db;
        --text-dim: #5a5d66;
        --accent: #00e5a0;
        --accent-dim: #00b87a;
        --red: #ff4b4b;
        --red-dim: #cc3333;
        --blue: #4da6ff;
        --yellow: #f5c842;
        --radius: 6px;
        --font-ui: "Syne", sans-serif;
        --font-mono: "IBM Plex Mono", monospace;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        background: var(--bg);
        color: var(--text);
        font-family: var(--font-mono);
        font-size: 13px;
        min-height: 100vh;
        user-select: none;
      }

      /* ‚îÄ‚îÄ‚îÄ TOP BAR ‚îÄ‚îÄ‚îÄ */
      .topbar {
        background: var(--surface);
        border-bottom: 1px solid var(--border);
        padding: 10px 24px;
        display: flex;
        align-items: center;
        gap: 16px;
        position: sticky;
        top: 0;
        z-index: 100;
      }
      .topbar .logo {
        font-family: var(--font-ui);
        font-weight: 800;
        font-size: 18px;
        color: var(--accent);
        letter-spacing: -0.5px;
      }
      .topbar .logo span {
        color: var(--text-dim);
        font-weight: 400;
      }
      .topbar .sep {
        width: 1px;
        height: 22px;
        background: var(--border);
      }
      .topbar .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: var(--text-dim);
        transition: background 0.3s;
      }
      .topbar .status-dot.connected {
        background: var(--accent);
        box-shadow: 0 0 6px var(--accent);
      }
      .topbar .status-label {
        color: var(--text-dim);
        font-size: 11px;
      }

      /* ‚îÄ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ‚îÄ */
      .layout {
        display: flex;
        min-height: calc(100vh - 44px);
      }

      /* ‚îÄ‚îÄ‚îÄ SIDEBAR (repozit√°≈ôe) ‚îÄ‚îÄ‚îÄ */
      .sidebar {
        width: 260px;
        background: var(--surface);
        border-right: 1px solid var(--border);
        display: flex;
        flex-direction: column;
      }
      .sidebar-head {
        padding: 14px 16px 10px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        border-bottom: 1px solid var(--border);
      }
      .sidebar-head .label {
        font-family: var(--font-ui);
        font-weight: 700;
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 1.2px;
        color: var(--text-dim);
      }
      .btn-icon {
        width: 26px;
        height: 26px;
        border-radius: var(--radius);
        border: 1px solid var(--border);
        background: transparent;
        color: var(--accent);
        font-size: 18px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition:
          background 0.15s,
          border-color 0.15s;
      }
      .btn-icon:hover {
        background: var(--surface2);
        border-color: var(--accent);
      }

      .repo-list {
        flex: 1;
        overflow-y: auto;
        padding: 6px 8px;
      }
      .repo-item {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 8px 10px;
        border-radius: var(--radius);
        cursor: pointer;
        transition: background 0.15s;
        position: relative;
      }
      .repo-item:hover {
        background: var(--surface2);
      }
      .repo-item.active {
        background: var(--surface2);
        border-left: 3px solid var(--accent);
      }
      .repo-item .icon {
        font-size: 15px;
        color: var(--blue);
      }
      .repo-item .name {
        flex: 1;
        font-size: 13px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .repo-item .visibility {
        font-size: 9px;
        font-family: var(--font-ui);
        text-transform: uppercase;
        letter-spacing: 0.8px;
        font-weight: 600;
        padding: 2px 5px;
        border-radius: 3px;
      }
      .repo-item .visibility.pub {
        color: var(--accent);
        background: rgba(0, 229, 160, 0.1);
      }
      .repo-item .visibility.priv {
        color: var(--yellow);
        background: rgba(245, 200, 66, 0.1);
      }

      /* ‚îÄ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ‚îÄ */
      .main {
        flex: 1;
        display: flex;
        flex-direction: column;
      }

      /* ‚îÄ‚îÄ‚îÄ LOGIN PANEL ‚îÄ‚îÄ‚îÄ */
      .login-panel {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .login-box {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 36px 40px;
        width: 420px;
        max-width: 90vw;
      }
      .login-box h2 {
        font-family: var(--font-ui);
        font-weight: 700;
        font-size: 20px;
        margin-bottom: 6px;
        color: #fff;
      }
      .login-box p {
        color: var(--text-dim);
        font-size: 12px;
        margin-bottom: 22px;
        line-height: 1.5;
      }
      .login-box label {
        display: block;
        font-size: 11px;
        color: var(--text-dim);
        margin-bottom: 5px;
        font-family: var(--font-ui);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.8px;
      }
      .login-box input {
        width: 100%;
        padding: 10px 12px;
        background: var(--bg);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        color: var(--text);
        font-family: var(--font-mono);
        font-size: 13px;
        outline: none;
        transition: border-color 0.2s;
      }
      .login-box input:focus {
        border-color: var(--accent);
      }
      .login-box input[type="password"] {
        letter-spacing: 3px;
      }

      .btn-primary {
        width: 100%;
        margin-top: 18px;
        padding: 11px;
        background: var(--accent);
        color: #0e0f11;
        border: none;
        border-radius: var(--radius);
        font-family: var(--font-ui);
        font-weight: 700;
        font-size: 13px;
        letter-spacing: 0.5px;
        cursor: pointer;
        transition:
          background 0.2s,
          transform 0.1s;
      }
      .btn-primary:hover {
        background: var(--accent-dim);
      }
      .btn-primary:active {
        transform: scale(0.98);
      }

      .login-box .hint {
        margin-top: 16px;
        font-size: 11px;
        color: var(--text-dim);
        line-height: 1.6;
      }
      .login-box .hint a {
        color: var(--blue);
        text-decoration: none;
      }
      .login-box .hint a:hover {
        text-decoration: underline;
      }

      /* ‚îÄ‚îÄ‚îÄ CONTENT (po p≈ôihl√°≈°en√≠) ‚îÄ‚îÄ‚îÄ */
      .content {
        flex: 1;
        padding: 24px;
        overflow-y: auto;
      }

      /* breadcrumb */
      .breadcrumb {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 12px;
        color: var(--text-dim);
        margin-bottom: 18px;
      }
      .breadcrumb .sep {
        color: var(--border);
      }
      .breadcrumb .active {
        color: var(--accent);
        font-weight: 600;
      }
      .breadcrumb span {
        cursor: pointer;
      }
      .breadcrumb span:hover {
        color: var(--text);
      }
      .breadcrumb .up-btn {
        width: 28px;
        height: 28px;
        border-radius: var(--radius);
        border: 1px solid var(--border);
        background: var(--surface);
        color: var(--accent);
        font-size: 16px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition:
          background 0.15s,
          border-color 0.15s;
        margin-right: 8px;
      }
      .breadcrumb .up-btn:hover {
        background: var(--surface2);
        border-color: var(--accent);
      }

      /* repo info header */
      .repo-header {
        display: flex;
        align-items: center;
        gap: 14px;
        margin-bottom: 20px;
      }
      .repo-header h3 {
        font-family: var(--font-ui);
        font-weight: 700;
        font-size: 17px;
        color: #fff;
      }
      .repo-header .desc {
        color: var(--text-dim);
        font-size: 12px;
        margin-top: 2px;
        cursor: pointer;
        padding: 4px 8px;
        border-radius: var(--radius);
        margin-left: -8px;
        transition: background 0.15s;
      }
      .repo-header .desc:hover {
        background: var(--surface2);
        color: var(--text);
      }
      .repo-header .desc em {
        font-style: italic;
        opacity: 0.7;
      }
      .repo-header .visibility-toggle {
        cursor: pointer;
        transition:
          transform 0.15s,
          opacity 0.15s;
        display: inline-block;
      }
      .repo-header .visibility-toggle:hover {
        transform: scale(1.05);
        opacity: 0.8;
      }
      .repo-header .stats {
        margin-left: auto;
        display: flex;
        gap: 14px;
      }
      .repo-header .stat {
        font-size: 11px;
        color: var(--text-dim);
      }
      .repo-header .stat span {
        color: var(--text);
        font-weight: 600;
      }

      /* file table */
      .file-table {
        width: 100%;
        border-collapse: collapse;
      }
      .file-table thead th {
        text-align: left;
        padding: 8px 12px;
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: #9a9da6;
        font-family: var(--font-ui);
        font-weight: 600;
        border-bottom: 1px solid var(--border);
      }
      .file-table tbody tr {
        border-bottom: 1px solid rgba(42, 45, 52, 0.5);
        transition: background 0.12s;
        cursor: pointer;
      }
      .file-table tbody tr:hover {
        background: var(--surface2);
      }
      .file-table td {
        padding: 9px 12px;
      }
      .file-table .icon {
        font-size: 15px;
        margin-right: 8px;
      }
      .file-table .file-name {
        color: var(--blue);
      }
      .file-table .folder-name {
        color: var(--yellow);
      }
      .file-table .meta {
        color: #9a9da6;
        font-size: 12px;
      }

      /* ‚îÄ‚îÄ‚îÄ NEW REPO MODAL ‚îÄ‚îÄ‚îÄ */
      .modal-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.55);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 200;
        backdrop-filter: blur(3px);
      }
      .modal {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 32px;
        width: 400px;
        max-width: 90vw;
      }
      .modal h3 {
        font-family: var(--font-ui);
        font-weight: 700;
        font-size: 17px;
        color: #fff;
        margin-bottom: 18px;
      }
      .modal label {
        display: block;
        font-size: 11px;
        color: var(--text-dim);
        margin-bottom: 5px;
        margin-top: 14px;
        font-family: var(--font-ui);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.8px;
      }
      .modal input,
      .modal textarea,
      .modal select {
        width: 100%;
        padding: 10px 12px;
        background: var(--bg);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        color: var(--text);
        font-family: var(--font-mono);
        font-size: 13px;
        outline: none;
        transition: border-color 0.2s;
      }
      .modal input:focus,
      .modal textarea:focus,
      .modal select:focus {
        border-color: var(--accent);
      }
      .modal select {
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='%235a5d66'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 12px center;
        padding-right: 30px;
      }
      .modal select option {
        background: var(--surface);
        color: var(--text);
      }
      .modal textarea {
        resize: vertical;
        min-height: 60px;
      }
      .modal-btns {
        display: flex;
        gap: 10px;
        margin-top: 22px;
        justify-content: flex-end;
      }
      .btn-cancel {
        padding: 9px 18px;
        background: transparent;
        border: 1px solid var(--border);
        border-radius: var(--radius);
        color: var(--text);
        font-family: var(--font-ui);
        font-size: 13px;
        cursor: pointer;
        transition: background 0.15s;
      }
      .btn-cancel:hover {
        background: var(--surface2);
      }
      .btn-confirm {
        padding: 9px 22px;
        background: var(--accent);
        border: none;
        border-radius: var(--radius);
        color: #0e0f11;
        font-family: var(--font-ui);
        font-weight: 700;
        font-size: 13px;
        cursor: pointer;
        transition: background 0.2s;
      }
      .btn-confirm:hover {
        background: var(--accent-dim);
      }
      .btn-danger {
        padding: 9px 22px;
        background: var(--red);
        border: none;
        border-radius: var(--radius);
        color: #fff;
        font-family: var(--font-ui);
        font-weight: 700;
        font-size: 13px;
        cursor: pointer;
        transition: background 0.2s;
      }
      .btn-danger:hover {
        background: var(--red-dim);
      }

      /* ‚îÄ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ‚îÄ */
      .toast {
        position: fixed;
        bottom: 24px;
        right: 24px;
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 12px 18px;
        font-size: 13px;
        color: var(--text);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
        transform: translateY(80px);
        opacity: 0;
        transition:
          transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1),
          opacity 0.3s;
        z-index: 300;
        max-width: 320px;
      }
      .toast.show {
        transform: translateY(0);
        opacity: 1;
      }
      .toast.success {
        border-color: var(--accent);
      }
      .toast.error {
        border-color: var(--red);
      }
      .toast .toast-title {
        font-family: var(--font-ui);
        font-weight: 700;
        font-size: 12px;
        margin-bottom: 2px;
      }
      .toast.success .toast-title {
        color: var(--accent);
      }
      .toast.error .toast-title {
        color: var(--red);
      }

      /* ‚îÄ‚îÄ‚îÄ CONTEXT MENU (file actions) ‚îÄ‚îÄ‚îÄ */
      .ctx-actions {
        display: flex;
        flex-direction: column;
        gap: 6px;
        margin-top: 8px;
      }
      .ctx-btn {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 11px 14px;
        background: var(--bg);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        color: var(--text);
        font-family: var(--font-mono);
        font-size: 13px;
        cursor: pointer;
        transition:
          background 0.15s,
          border-color 0.15s;
        text-align: left;
        width: 100%;
      }
      .ctx-btn:hover {
        background: var(--surface2);
        border-color: var(--accent);
      }
      .ctx-btn.danger:hover {
        border-color: var(--red);
      }
      .ctx-btn .ctx-icon {
        font-size: 18px;
        width: 22px;
        text-align: center;
      }
      .ctx-btn .ctx-label {
        flex: 1;
      }
      .ctx-btn .ctx-desc {
        font-size: 11px;
        color: #9a9da6;
        margin-top: 1px;
      }

      /* ‚îÄ‚îÄ‚îÄ RENAME INPUT ROW ‚îÄ‚îÄ‚îÄ */
      .rename-row {
        display: none;
        flex-direction: column;
        gap: 8px;
        margin-top: 4px;
      }
      .rename-row.show {
        display: flex;
      }
      .rename-row input {
        width: 100%;
        padding: 9px 11px;
        background: var(--bg);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        color: var(--text);
        font-family: var(--font-mono);
        font-size: 13px;
        outline: none;
      }
      .rename-row input:focus {
        border-color: var(--accent);
      }
      .rename-row .rename-btns {
        display: flex;
        gap: 8px;
      }

      /* ‚îÄ‚îÄ‚îÄ SCROLLBAR ‚îÄ‚îÄ‚îÄ */
      ::-webkit-scrollbar {
        width: 6px;
      }
      ::-webkit-scrollbar-track {
        background: transparent;
      }
      ::-webkit-scrollbar-thumb {
        background: var(--border);
        border-radius: 3px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: var(--text-dim);
      }

      /* ‚îÄ‚îÄ‚îÄ LOADING ‚îÄ‚îÄ‚îÄ */
      .spinner {
        width: 18px;
        height: 18px;
        border: 2px solid var(--border);
        border-top-color: var(--accent);
        border-radius: 50%;
        animation: spin 0.6s linear infinite;
        display: inline-block;
      }
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: var(--text-dim);
      }
      .empty-state .big {
        font-size: 38px;
        margin-bottom: 10px;
      }
      .empty-state p {
        font-size: 13px;
      }

      .confirm-name-row {
        margin-top: 12px;
      }
      .confirm-name-row input {
        border-color: var(--red) !important;
      }

      /* ‚îÄ‚îÄ‚îÄ FILE VIEWER ‚îÄ‚îÄ‚îÄ */
      .file-viewer {
        width: 80vw;
        max-width: 900px;
        max-height: 80vh;
        display: flex;
        flex-direction: column;
      }
      .file-viewer-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding-bottom: 16px;
        border-bottom: 1px solid var(--border);
      }
      .file-viewer-content {
        flex: 1;
        overflow-y: auto;
        margin-top: 16px;
        background: var(--bg);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 16px;
      }
      .file-viewer-content pre {
        margin: 0;
        font-family: var(--font-mono);
        font-size: 12px;
        line-height: 1.6;
        color: var(--text);
        white-space: pre-wrap;
        word-wrap: break-word;
      }
      .file-viewer-actions {
        display: flex;
        gap: 10px;
        margin-top: 16px;
      }

      /* ‚îÄ‚îÄ‚îÄ TOOLBAR ACTIONS ‚îÄ‚îÄ‚îÄ */
      .toolbar-actions {
        display: flex;
        gap: 10px;
        margin-bottom: 16px;
        flex-wrap: wrap;
      }
      .btn-secondary {
        padding: 9px 18px;
        background: var(--surface2);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        color: var(--text);
        font-family: var(--font-ui);
        font-size: 13px;
        font-weight: 600;
        cursor: pointer;
        transition:
          background 0.15s,
          border-color 0.15s;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .btn-secondary:hover {
        background: var(--surface);
        border-color: var(--accent);
      }
      .btn-secondary:active {
        transform: scale(0.98);
      }

      /* ‚îÄ‚îÄ‚îÄ FILE SELECTION ‚îÄ‚îÄ‚îÄ */
      .file-checkbox {
        width: 18px;
        height: 18px;
        cursor: pointer;
        accent-color: var(--accent);
      }
      .file-table td.checkbox-cell {
        width: 40px;
        text-align: center;
      }
      .selection-bar {
        position: fixed;
        bottom: 24px;
        left: 50%;
        transform: translateX(-50%);
        background: var(--surface);
        border: 1px solid var(--accent);
        border-radius: 8px;
        padding: 12px 20px;
        display: flex;
        align-items: center;
        gap: 16px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
        z-index: 300;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s;
      }
      .selection-bar.show {
        opacity: 1;
        pointer-events: auto;
      }
      .selection-count {
        color: var(--accent);
        font-weight: 600;
        font-size: 14px;
      }

      /* ‚îÄ‚îÄ‚îÄ DRAG & DROP ‚îÄ‚îÄ‚îÄ */
      .drag-drop-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 229, 160, 0.1);
        backdrop-filter: blur(3px);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        border: 3px dashed var(--accent);
        pointer-events: none;
      }
      .drag-drop-overlay.active {
        display: flex;
      }
      .drag-drop-message {
        background: var(--surface);
        border: 2px solid var(--accent);
        border-radius: 12px;
        padding: 40px 60px;
        text-align: center;
      }
      .drag-drop-message .icon {
        font-size: 48px;
        margin-bottom: 16px;
      }
      .drag-drop-message .title {
        font-family: var(--font-ui);
        font-size: 20px;
        font-weight: 700;
        color: var(--accent);
        margin-bottom: 8px;
      }
      .drag-drop-message .desc {
        color: var(--text-dim);
        font-size: 13px;
      }
      .content.drag-over {
        background: rgba(0, 229, 160, 0.05);
      }

      /* Markdown viewer styles */
      #markdownViewer h1 {
        font-size: 24px;
        font-weight: 700;
        margin: 20px 0 12px;
        color: var(--accent);
        border-bottom: 2px solid var(--border);
        padding-bottom: 8px;
      }
      #markdownViewer h2 {
        font-size: 20px;
        font-weight: 600;
        margin: 18px 0 10px;
        color: var(--text);
      }
      #markdownViewer h3 {
        font-size: 16px;
        font-weight: 600;
        margin: 16px 0 8px;
        color: var(--text);
      }
      #markdownViewer p {
        margin: 8px 0;
        line-height: 1.6;
      }
      #markdownViewer code {
        background: var(--surface);
        padding: 2px 6px;
        border-radius: 4px;
        font-family: var(--font-mono);
        font-size: 12px;
        color: var(--accent);
      }
      #markdownViewer pre {
        background: var(--surface);
        padding: 12px;
        border-radius: 6px;
        overflow-x: auto;
        margin: 12px 0;
        border: 1px solid var(--border);
      }
      #markdownViewer pre code {
        background: none;
        padding: 0;
        color: var(--text);
      }
      #markdownViewer ul,
      #markdownViewer ol {
        margin: 8px 0;
        padding-left: 24px;
      }
      #markdownViewer li {
        margin: 4px 0;
      }
      #markdownViewer a {
        color: var(--accent);
        text-decoration: none;
      }
      #markdownViewer a:hover {
        text-decoration: underline;
      }
      #markdownViewer blockquote {
        border-left: 3px solid var(--accent);
        padding-left: 12px;
        margin: 12px 0;
        color: var(--text-dim);
        font-style: italic;
      }
      #markdownViewer hr {
        border: none;
        border-top: 1px solid var(--border);
        margin: 20px 0;
      }
      #markdownViewer table {
        border-collapse: collapse;
        width: 100%;
        margin: 12px 0;
      }
      #markdownViewer th,
      #markdownViewer td {
        border: 1px solid var(--border);
        padding: 8px;
        text-align: left;
      }
      #markdownViewer th {
        background: var(--surface);
        font-weight: 600;
      }
      #markdownViewer img {
        max-width: 100%;
        height: auto;
        border-radius: 6px;
        margin: 12px 0;
      }
    </style>
  </head>
  <body>
    <!-- TOPBAR -->
    <div class="topbar">
      <div class="logo">GitHub<span>Manager</span></div>
      <div class="sep"></div>
      <div class="status-dot" id="statusDot"></div>
      <div class="status-label" id="statusLabel">Nep≈ôihl√°≈°en</div>
      <div style="margin-left: auto" id="logoutArea" style="display: none">
        <button
          class="btn-cancel"
          id="logoutBtn"
          style="display: none; padding: 6px 14px; font-size: 12px"
        >
          Logout
        </button>
      </div>
    </div>

    <!-- LAYOUT -->
    <div class="layout">
      <!-- SIDEBAR -->
      <div class="sidebar" id="sidebar" style="display: none">
        <div class="sidebar-head">
          <div class="label">Repozit√°≈ôe</div>
          <div style="display: flex; gap: 6px">
            <button
              class="btn-icon"
              id="backupBtn"
              title="St√°hnut v≈°echny repo jako ZIP"
              style="color: var(--yellow); font-size: 15px"
            >
              üíæ
            </button>
            <button class="btn-icon" id="newRepoBtn" title="Nov√Ω repozit√°≈ô">
              +
            </button>
          </div>
        </div>
        <div class="repo-list" id="repoList">
          <div class="empty-state" style="padding: 40px 10px">
            <div class="big">üì≠</div>
            <p>≈Ω√°dn√© repo</p>
          </div>
        </div>
      </div>

      <!-- MAIN -->
      <div class="main">
        <!-- LOGIN PANEL -->
        <div class="login-panel" id="loginPanel">
          <div class="login-box">
            <h2>P≈ôihl√°≈°en√≠ p≈ôes GitHub Token</h2>
            <p>
              Zad√°≈° tv√≥j personal access token a m√°≈° pln√Ω p≈ô√≠stup ke v≈°em
              repozit√°≈ô≈Øm ‚Äì ƒç√≠st i pisat.
            </p>
            <label>GitHub Personal Access Token</label>
            <input
              type="password"
              id="tokenInput"
              placeholder="ghp_xxxxxxxxxxxxxxxxx"
              autocomplete="off"
            />
            <button class="btn-primary" id="loginBtn">P≈ôihl√°sit se</button>
            <div class="hint">
              Nem√°≈° token? Vytvo≈ô si ho
              <a href="https://github.com/settings/tokens/new" target="_blank"
                >tady na GitHubu ‚Üí</a
              ><br />
              Pot≈ôebu≈° permissions: <strong>repo</strong> (full),
              <strong>user:read</strong>
            </div>
          </div>
        </div>

        <!-- CONTENT (po p≈ôihl√°≈°en√≠) -->
        <div class="content" id="mainContent" style="display: none">
          <div class="breadcrumb" id="breadcrumb">
            <span>üè† Home</span>
          </div>
          <div
            id="fileToolbar"
            style="
              display: none;
              padding: 12px;
              background: var(--surface);
              border-bottom: 1px solid var(--border);
              display: flex;
              gap: 8px;
              align-items: center;
              flex-wrap: wrap;
            "
          >
            <input
              type="text"
              id="fileFilterInput"
              placeholder="üîç Filtrovat soubory..."
              style="
                flex: 1;
                min-width: 200px;
                padding: 8px 12px;
                background: var(--bg);
                border: 1px solid var(--border);
                border-radius: 6px;
                color: var(--text);
                font-size: 12px;
                font-family: var(--font-mono);
              "
            />
            <select
              id="fileSortSelect"
              style="
                padding: 8px 12px;
                background: var(--bg);
                border: 1px solid var(--border);
                border-radius: 6px;
                color: var(--text);
                font-size: 12px;
                font-family: var(--font-mono);
              "
            >
              <option value="name-asc">üìù Jm√©no (A-Z)</option>
              <option value="name-desc">üìù Jm√©no (Z-A)</option>
              <option value="size-asc">üìè Velikost (‚Üë)</option>
              <option value="size-desc">üìè Velikost (‚Üì)</option>
              <option value="type-asc">üìã Typ (A-Z)</option>
            </select>
            <button
              class="btn-icon"
              id="newFileBtn"
              title="Vytvo≈ôit nov√Ω soubor/slo≈æku"
              style="
                padding: 8px 16px;
                background: var(--accent);
                color: var(--bg);
                font-weight: 600;
              "
            >
              ‚ûï Nov√Ω soubor/slo≈æka
            </button>
            </button>
          </div>
          <div id="repoView"></div>
        </div>
      </div>
    </div>

    <!-- NEW REPO MODAL -->
    <div class="modal-overlay" id="newRepoModal" style="display: none">
      <div class="modal">
        <h3>‚ú® Nov√Ω Repozit√°≈ô</h3>
        <label>N√°zev repozit√°≈ôe</label>
        <input type="text" id="newRepoName" placeholder="moj-projekt" />
        <label>Popis (voliteln√©)</label>
        <textarea
          id="newRepoDesc"
          placeholder="Kr√°tk√Ω popis projektu..."
        ></textarea>
        <label>Viditelnost</label>
        <select id="newRepoVisibility">
          <option value="false">üåê Public ‚Äì viditeln√Ω pro v≈°echny</option>
          <option value="true">üîí Private ‚Äì viditeln√Ω jen pro tebe</option>
        </select>
        <label>
          <input
            type="checkbox"
            id="newRepoReadme"
            style="margin-right: 6px; accent-color: var(--accent)"
            checked
          />
          P≈ôidej README.md (tak repo ne bude pr√°zdn√©)
        </label>
        <div class="modal-btns">
          <button class="btn-cancel" id="cancelNewRepo">Zru≈°it</button>
          <button class="btn-confirm" id="confirmNewRepo">Vytvo≈ôit</button>
        </div>
      </div>
    </div>

    <!-- DELETE REPO MODAL -->
    <div class="modal-overlay" id="deleteRepoModal" style="display: none">
      <div class="modal">
        <h3 style="color: var(--red)">üóëÔ∏è Smazat repozit√°≈ô</h3>
        <p style="color: var(--text-dim); font-size: 12px; margin-bottom: 4px">
          Toto akci nelze vr√°tit. Potvrdil ji zad√°n√≠m posledn√≠ch dvou p√≠smen
          n√°zev:
        </p>
        <p
          style="
            color: var(--yellow);
            font-weight: 600;
            font-size: 13px;
            margin-bottom: 4px;
          "
          id="deleteRepoNameShow"
        ></p>
        <p style="color: var(--text-dim); font-size: 11px; margin-bottom: 10px">
          üëâ Dopl≈à posledn√≠ dvƒõ p√≠smena:
          <strong
            style="color: var(--accent); font-size: 13px"
            id="deleteHintLetters"
          ></strong>
        </p>
        <label>Posledn√≠ dvƒõ p√≠smena n√°zev</label>
        <input
          type="text"
          id="deleteRepoConfirm"
          placeholder="Npr. ak"
          maxlength="2"
        />
        <div class="modal-btns">
          <button class="btn-cancel" id="cancelDeleteRepo">Zru≈°it</button>
          <button class="btn-danger" id="confirmDeleteRepo" disabled>
            Smazat
          </button>
        </div>
      </div>
    </div>

    <!-- BACKUP PROGRESS MODAL -->
    <div class="modal-overlay" id="backupModal" style="display: none">
      <div class="modal" style="width: 440px">
        <h3>üíæ Backup v≈°ech repozit√°≈ô≈Ø</h3>
        <p style="color: var(--text-dim); font-size: 12px; margin-bottom: 16px">
          Stahuje se obsah v≈°ech repo a bal√≠ do ZIP...
        </p>
        <div
          id="backupRepoList"
          style="max-height: 200px; overflow-y: auto; margin-bottom: 14px"
        ></div>
        <!-- progress bar -->
        <div
          style="
            background: var(--bg);
            border-radius: 4px;
            height: 6px;
            overflow: hidden;
            margin-bottom: 8px;
          "
        >
          <div
            id="backupProgressBar"
            style="
              height: 100%;
              width: 0%;
              background: var(--accent);
              transition: width 0.3s;
              border-radius: 4px;
            "
          ></div>
        </div>
        <div
          style="
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: var(--text-dim);
          "
        >
          <span id="backupStatus">ƒåek√° na zaƒç√°tek...</span>
          <span id="backupPercent">0%</span>
        </div>
        <div class="modal-btns" style="margin-top: 18px">
          <button class="btn-cancel" id="cancelBackup">Zru≈°it</button>
        </div>
      </div>
    </div>

    <!-- FILE CONTEXT MENU MODAL -->
    <div class="modal-overlay" id="ctxModal" style="display: none">
      <div class="modal" style="width: 380px">
        <div
          style="
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 16px;
          "
        >
          <span id="ctxFileIcon" style="font-size: 24px">üìÑ</span>
          <div>
            <div
              style="color: #fff; font-weight: 600; font-size: 14px"
              id="ctxFileName"
            ></div>
            <div style="color: #9a9da6; font-size: 11px" id="ctxFileMeta"></div>
          </div>
        </div>
        <div class="ctx-actions" id="ctxActions"></div>
        <!-- rename input (hidden by default) -->
        <div class="rename-row" id="renameRow">
          <input type="text" id="renameInput" placeholder="Nov√Ω n√°zev..." />
          <div class="rename-btns">
            <button class="btn-confirm" id="confirmRename" style="flex: 1">
              P≈ôejmenovat
            </button>
            <button class="btn-cancel" id="cancelRename">Zru≈°it</button>
          </div>
        </div>
      </div>
    </div>

    <!-- REPO CONTEXT MENU MODAL -->
    <div class="modal-overlay" id="repoCtxModal" style="display: none">
      <div class="modal" style="width: 380px">
        <div
          style="
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 16px;
          "
        >
          <span style="font-size: 24px">üìÅ</span>
          <div>
            <div
              style="color: #fff; font-weight: 600; font-size: 14px"
              id="repoCtxName"
            ></div>
            <div style="color: #9a9da6; font-size: 11px" id="repoCtxMeta"></div>
          </div>
        </div>
        <div class="ctx-actions">
          <button class="ctx-btn" id="repoCtxRename">
            <span class="ctx-icon">‚úèÔ∏è</span>
            <div>
              <div class="ctx-label">P≈ôejmenovat</div>
              <div class="ctx-desc">Zmƒõ≈à n√°zev repozit√°≈ôe</div>
            </div>
          </button>
          <button class="ctx-btn danger" id="repoCtxDelete">
            <span class="ctx-icon">üóëÔ∏è</span>
            <div>
              <div class="ctx-label" style="color: var(--red)">Smazat</div>
              <div class="ctx-desc">Nav≈ædy sma≈æe repozit√°≈ô</div>
            </div>
          </button>
        </div>
      </div>
    </div>

    <!-- EDIT DESCRIPTION MODAL -->
    <div class="modal-overlay" id="editDescModal" style="display: none">
      <div class="modal">
        <h3>üìù Upravit popis</h3>
        <label>Popis repozit√°≈ôe</label>
        <textarea
          id="editDescInput"
          placeholder="Kr√°tk√Ω popis projektu..."
          style="min-height: 80px"
        ></textarea>
        <div class="modal-btns">
          <button class="btn-cancel" id="cancelEditDesc">Zru≈°it</button>
          <button class="btn-confirm" id="confirmEditDesc">Ulo≈æit</button>
        </div>
      </div>
    </div>

    <!-- FILE VIEWER MODAL -->
    <div class="modal-overlay" id="fileViewerModal" style="display: none">
      <div class="modal file-viewer">
        <div class="file-viewer-header">
          <div style="display: flex; align-items: center; gap: 10px">
            <span id="viewerFileIcon" style="font-size: 24px">üìÑ</span>
            <div>
              <div
                style="color: #fff; font-weight: 600; font-size: 14px"
                id="viewerFileName"
              ></div>
              <div
                style="color: #9a9da6; font-size: 11px"
                id="viewerFileMeta"
              ></div>
            </div>
          </div>
          <button class="btn-cancel" id="closeFileViewer">Zav≈ô√≠t</button>
        </div>
        <div
          style="
            padding: 12px;
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
          "
        >
          <input
            type="text"
            id="searchInput"
            placeholder="Naj√≠t text..."
            style="
              flex: 1;
              min-width: 200px;
              padding: 8px 12px;
              background: var(--bg);
              border: 1px solid var(--border);
              border-radius: 6px;
              color: var(--text);
              font-size: 12px;
              font-family: var(--font-mono);
            "
          />
          <button
            class="btn-icon"
            id="findPrevBtn"
            title="P≈ôedchoz√≠ v√Ωskyt"
            style="padding: 8px 12px"
          >
            ‚ñ≤
          </button>
          <button
            class="btn-icon"
            id="findNextBtn"
            title="Dal≈°√≠ v√Ωskyt"
            style="padding: 8px 12px"
          >
            ‚ñº
          </button>
          <button
            class="btn-icon"
            id="toggleReplaceBtn"
            title="Zobrazit nahrazen√≠"
            style="padding: 8px 12px"
          >
            üîÑ
          </button>
          <div
            id="replaceControls"
            style="
              display: none;
              flex: 1 1 100%;
              gap: 8px;
              margin-top: 4px;
              display: flex;
            "
          >
            <input
              type="text"
              id="replaceInput"
              placeholder="Nahradit za..."
              style="
                flex: 1;
                min-width: 200px;
                padding: 8px 12px;
                background: var(--bg);
                border: 1px solid var(--border);
                border-radius: 6px;
                color: var(--text);
                font-size: 12px;
                font-family: var(--font-mono);
              "
            />
            <button
              class="btn-confirm"
              id="replaceBtn"
              style="padding: 8px 16px; font-size: 12px"
            >
              Nahradit
            </button>
            <button
              class="btn-confirm"
              id="replaceAllBtn"
              style="padding: 8px 16px; font-size: 12px"
            >
              Nahradit v≈°e
            </button>
          </div>
          <span
            id="searchCounter"
            style="
              color: var(--text-dim);
              font-size: 11px;
              padding: 8px 12px;
              white-space: nowrap;
            "
          ></span>
        </div>
        <div class="file-viewer-content">
          <pre
            id="fileViewerContent"
            contenteditable="true"
            spellcheck="false"
            style="outline: none"
          ></pre>
          <div
            id="imageViewerContainer"
            style="display: none; padding: 20px; text-align: center"
          >
            <img
              id="imageViewer"
              style="max-width: 100%; max-height: 600px; border-radius: 8px"
            />
          </div>
          <div
            id="markdownViewerContainer"
            style="display: none; padding: 20px"
          >
            <div
              id="markdownViewer"
              style="color: var(--text); line-height: 1.6"
            ></div>
          </div>
        </div>
        <div class="file-viewer-actions">
          <button
            class="btn-confirm"
            id="saveFileBtn"
            style="flex: 1; display: none"
          >
            üíæ Ulo≈æit zmƒõny
          </button>
          <button class="btn-confirm" id="downloadFromViewer" style="flex: 1">
            ‚¨áÔ∏è St√°hnout soubor
          </button>
        </div>
      </div>
    </div>

    <!-- NEW FILE/FOLDER MODAL -->
    <div class="modal-overlay" id="newFileModal" style="display: none">
      <div class="modal">
        <h3>‚ú® Vytvo≈ôit nov√Ω...</h3>
        <label>Typ</label>
        <select id="newItemType">
          <option value="file">üìÑ Soubor</option>
          <option value="folder">üìÅ Slo≈æka</option>
        </select>
        <label>N√°zev</label>
        <input
          type="text"
          id="newItemName"
          placeholder="nazev.txt nebo slozka/"
        />
        <div id="fileContentSection">
          <label>Obsah (voliteln√©)</label>
          <textarea
            id="newFileContent"
            placeholder="Obsah nov√©ho souboru..."
            rows="8"
          ></textarea>
        </div>
        <div class="modal-btns">
          <button class="btn-cancel" id="cancelNewItem">Zru≈°it</button>
          <button class="btn-confirm" id="confirmNewItem">Vytvo≈ôit</button>
        </div>
      </div>
    </div>

    <!-- TOAST -->
    <div class="toast" id="toast">
      <div class="toast-title" id="toastTitle"></div>
      <div id="toastMsg"></div>
    </div>

    <!-- DRAG & DROP OVERLAY -->
    <div class="drag-drop-overlay" id="dragDropOverlay">
      <div class="drag-drop-message">
        <div class="icon">üì§</div>
        <div class="title">P≈ôet√°hni soubory nebo slo≈æky</div>
        <div class="desc">Pustit pro nahr√°n√≠ do repozit√°≈ôe</div>
      </div>
    </div>

    <script>
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      //  STATE
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      let TOKEN = "";
      let USERNAME = "";
      let REPOS = [];
      let CURRENT_REPO = null;
      let CURRENT_PATH = "";
      let DELETE_TARGET = "";

      const API = "https://api.github.com";
      const STORAGE_KEY = "gh_mgr_token";

      function saveToken(token) {
        localStorage.setItem(STORAGE_KEY, btoa(token));
      }
      function loadToken() {
        const v = localStorage.getItem(STORAGE_KEY);
        return v ? atob(v) : null;
      }
      function clearToken() {
        localStorage.removeItem(STORAGE_KEY);
      }

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      //  UTILS
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      function toast(msg, type = "success", duration = 3200) {
        const t = document.getElementById("toast");
        const title = document.getElementById("toastTitle");
        const body = document.getElementById("toastMsg");
        title.textContent = type === "success" ? "‚úì √öspƒõch" : "‚úï Chyba";
        body.textContent = msg;
        t.className = "toast " + type;
        t.classList.add("show");
        setTimeout(() => t.classList.remove("show"), duration);
      }

      async function ghFetch(endpoint, options = {}) {
        const res = await fetch(API + endpoint, {
          ...options,
          headers: {
            Authorization: "token " + TOKEN,
            Accept: "application/vnd.github.v3+json",
            "Content-Type": "application/json",
            ...(options.headers || {}),
          },
        });
        if (res.status === 204) return null;
        const data = await res.json();
        if (!res.ok) throw new Error(data.message || "GitHub API error");
        return data;
      }

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      //  LOGIN / LOGOUT
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      document.getElementById("loginBtn").onclick = async () => {
        const token = document.getElementById("tokenInput").value.trim();
        if (!token) return toast("Zad√°≈° token pros√≠m.", "error");
        TOKEN = token;

        try {
          const user = await ghFetch("/user");
          USERNAME = user.login;
          saveToken(TOKEN);
          await loadRepos();
          // UI switch
          document.getElementById("loginPanel").style.display = "none";
          document.getElementById("sidebar").style.display = "flex";
          document.getElementById("mainContent").style.display = "block";
          document.getElementById("statusDot").classList.add("connected");
          document.getElementById("statusLabel").textContent =
            "P≈ôihl√°≈°en jako " + USERNAME;
          document.getElementById("logoutBtn").style.display = "inline-block";
          document.getElementById("logoutArea").style.display = "block";
          showHomeView();
          toast("P≈ôihl√°≈°en jako " + USERNAME);
        } catch (e) {
          toast("Neplatn√Ω token nebo chyba: " + e.message, "error");
          TOKEN = "";
        }
      };

      document.getElementById("logoutBtn").onclick = () => {
        TOKEN = "";
        USERNAME = "";
        REPOS = [];
        CURRENT_REPO = null;
        CURRENT_PATH = "";
        clearToken();
        document.getElementById("tokenInput").value = "";
        document.getElementById("loginPanel").style.display = "flex";
        document.getElementById("sidebar").style.display = "none";
        document.getElementById("mainContent").style.display = "none";
        document.getElementById("statusDot").classList.remove("connected");
        document.getElementById("statusLabel").textContent = "Nep≈ôihl√°≈°en";
        document.getElementById("logoutBtn").style.display = "none";
        toast("Odhl√°≈°en.");
      };

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      //  REPOS
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      async function loadRepos() {
        REPOS = await ghFetch("/user/repos?per_page=100&sort=updated");
        renderRepoList();
      }

      function renderRepoList() {
        const list = document.getElementById("repoList");
        if (!REPOS.length) {
          list.innerHTML =
            '<div class="empty-state" style="padding:40px 10px;"><div class="big">üì≠</div><p>≈Ω√°dn√© repo</p></div>';
          return;
        }
        list.innerHTML = REPOS.map(
          (r) => `
        <div class="repo-item ${CURRENT_REPO === r.name ? "active" : ""}" data-repo="${r.name}">
          <span class="icon">üìÅ</span>
          <span class="name">${r.name}</span>
          <span class="visibility ${r.private ? "priv" : "pub"}">${r.private ? "üîí" : "üåê"}</span>
        </div>
      `,
        ).join("");

        // click ‚Üí open repo
        list.querySelectorAll(".repo-item").forEach((el) => {
          el.addEventListener("click", (e) => {
            openRepo(el.dataset.repo);
          });
        });
      }

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      //  OPEN REPO / BROWSE FILES
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      // Glob√°ln√≠ promƒõnn√© pro filtrov√°n√≠ a t≈ô√≠dƒõn√≠
      let ALL_FILES = [];
      let CURRENT_SORT = "name-asc";
      let CURRENT_FILTER = "";

      async function openRepo(repoName, path = "") {
        CURRENT_REPO = repoName;
        CURRENT_PATH = path;
        renderRepoList(); // highlight

        const view = document.getElementById("repoView");
        const toolbar = document.getElementById("fileToolbar");
        view.innerHTML = '<div class="spinner"></div>';
        toolbar.style.display = "flex";

        try {
          const endpoint = path
            ? `/repos/${USERNAME}/${repoName}/contents/${path}`
            : `/repos/${USERNAME}/${repoName}/contents`;
          const contents = await ghFetch(endpoint);
          const repoInfo = await ghFetch(`/repos/${USERNAME}/${repoName}`);

          ALL_FILES = contents;
          renderFileList(repoInfo, repoName, path);
        } catch (e) {
          view.innerHTML = `<div class="empty-state"><div class="big">‚ö†Ô∏è</div><p>Chyba: ${e.message}</p></div>`;
          toolbar.style.display = "none";
        }
      }

      function renderFileList(repoInfo, repoName, path) {
        const view = document.getElementById("repoView");

        // Filtrov√°n√≠
        let filtered = ALL_FILES;
        if (CURRENT_FILTER) {
          const filter = CURRENT_FILTER.toLowerCase();
          filtered = ALL_FILES.filter((item) =>
            item.name.toLowerCase().includes(filter),
          );
        }

        // T≈ô√≠dƒõn√≠
        let sorted = [...filtered];
        switch (CURRENT_SORT) {
          case "name-asc":
            sorted.sort((a, b) => {
              if (a.type === "dir" && b.type !== "dir") return -1;
              if (a.type !== "dir" && b.type === "dir") return 1;
              return a.name.localeCompare(b.name);
            });
            break;
          case "name-desc":
            sorted.sort((a, b) => {
              if (a.type === "dir" && b.type !== "dir") return -1;
              if (a.type !== "dir" && b.type === "dir") return 1;
              return b.name.localeCompare(a.name);
            });
            break;
          case "size-asc":
            sorted.sort((a, b) => (a.size || 0) - (b.size || 0));
            break;
          case "size-desc":
            sorted.sort((a, b) => (b.size || 0) - (a.size || 0));
            break;
          case "type-asc":
            sorted.sort((a, b) => {
              const extA = a.name.split(".").pop().toLowerCase();
              const extB = b.name.split(".").pop().toLowerCase();
              return extA.localeCompare(extB);
            });
            break;
        }

        // breadcrumb with up button
        let bc = "";

        // P≈ôidat tlaƒç√≠tko "o slo≈æku v√Ω≈°" pokud nejsme v root
        if (path) {
          const parts = path.split("/");
          const parentPath = parts.slice(0, -1).join("/");
          bc += `<button class="up-btn" onclick="openRepo('${repoName}', '${parentPath}')" title="O slo≈æku v√Ω≈°">‚Üë</button>`;
        } else if (CURRENT_REPO) {
          bc += `<button class="up-btn" onclick="showHomeView()" title="Zpƒõt na home">‚Üë</button>`;
        }

        bc += `<span onclick="showHomeView()" style="cursor:pointer;">üè† Home</span>`;
        bc += ` <span class="sep">‚Ä∫</span> <span onclick="openRepo('${repoName}')" style="cursor:pointer;" ${!path ? 'class="active"' : ""}>${repoName}</span>`;
        if (path) {
          const parts = path.split("/");
          let cumul = "";
          parts.forEach((p, i) => {
            cumul += (cumul ? "/" : "") + p;
            const isLast = i === parts.length - 1;
            bc += ` <span class="sep">‚Ä∫</span> <span ${isLast ? 'class="active"' : `onclick="openRepo('${repoName}','${cumul}')" style="cursor:pointer;"`}>${p}</span>`;
          });
        }
        document.getElementById("breadcrumb").innerHTML = bc;

        // table
        let html = `
          <div class="repo-header">
            <div>
              <h3>üìÅ ${repoName} <span class="visibility ${repoInfo.private ? "priv" : "pub"} visibility-toggle"
                data-repo="${repoName}" data-private="${repoInfo.private}"
                style="font-size:11px; vertical-align:middle;"
                title="Klikni pro zmƒõnu viditelnosti">${repoInfo.private ? "üîí Private" : "üåê Public"}</span></h3>
              <div class="desc" data-repo="${repoName}" data-desc="${repoInfo.description || ""}" title="Klikni pro √∫pravu popisu">${repoInfo.description || "<em>Klikni pro p≈ôid√°n√≠ popisu</em>"}</div>
            </div>
            <div class="stats">
              <div class="stat">‚≠ê <span>${repoInfo.stargazers_count}</span></div>
              <div class="stat">üîÄ <span>${repoInfo.forks_count}</span></div>
              <div class="stat">üìù <span>${repoInfo.open_issues_count} issues</span></div>
            </div>
          </div>
          <div class="toolbar-actions">
            <button class="btn-secondary" id="uploadFilesBtn">
              <span>üì§</span> Nahr√°t soubory
            </button>
            <button class="btn-secondary" id="selectAllBtn">
              <span>‚òëÔ∏è</span> Vybrat v≈°e
            </button>
            <button class="btn-secondary" id="deselectAllBtn" style="display:none;">
              <span>‚¨ú</span> Zru≈°it v√Ωbƒõr
            </button>
          </div>
          <table class="file-table">
            <thead><tr>
              <th style="width:40px;"><input type="checkbox" id="selectAllCheckbox" class="file-checkbox" /></th>
              <th>N√°zev</th>
              <th>Typ</th>
              <th>Velikost</th>
            </tr></thead>
            <tbody>
        `;
        sorted.forEach((item) => {
          const isDir = item.type === "dir";
          const iconEmoji = isDir ? "üìÇ" : getFileIcon(item.name);
          const nameClass = isDir ? "folder-name" : "file-name";
          const size = isDir ? "‚Äî" : formatBytes(item.size);
          html += `
            <tr class="file-row" data-name="${item.name}" data-path="${item.path}" data-type="${item.type}" data-size="${item.size || 0}">
              <td class="checkbox-cell"><input type="checkbox" class="file-checkbox row-checkbox" data-path="${item.path}" /></td>
              <td><span class="icon">${iconEmoji}</span><span class="${nameClass}">${item.name}</span></td>
              <td class="meta">${isDir ? "Slo≈æka" : "Soubor"}</td>
              <td class="meta">${size}</td>
            </tr>
          `;
        });
        html += "</tbody></table>";
        view.innerHTML = html;

        // bind click events on rows
        view.querySelectorAll(".file-row").forEach((row) => {
          // Lev√Ω klik: otev≈ô√≠t soubor/slo≈æku
          row.addEventListener("click", (e) => {
            // Pokud klikl na checkbox, neotv√≠rej soubor
            if (
              e.target.classList.contains("file-checkbox") ||
              e.target.classList.contains("checkbox-cell")
            ) {
              return;
            }
            e.preventDefault();
            const isDir = row.dataset.type === "dir";
            if (isDir) {
              // Otev≈ô√≠t slo≈æku
              openRepo(repoName, row.dataset.path);
            } else {
              // Otev≈ô√≠t soubor (zobrazit obsah nebo preview)
              openFile(row.dataset.name, row.dataset.path, repoName);
            }
          });

          // Prav√Ω klik: kontextov√© menu
          row.addEventListener("contextmenu", (e) => {
            e.preventDefault();
            openFileContext(
              row.dataset.name,
              row.dataset.path,
              row.dataset.type,
              parseInt(row.dataset.size),
              repoName,
            );
          });

          // Touch podpora (dlouh√Ω stisk) pro mobil
          let touchTimer = null;
          row.addEventListener("touchstart", (e) => {
            touchTimer = setTimeout(() => {
              e.preventDefault();
              openFileContext(
                row.dataset.name,
                row.dataset.path,
                row.dataset.type,
                parseInt(row.dataset.size),
                repoName,
              );
            }, 500);
          });
          row.addEventListener("touchend", () => {
            if (touchTimer) clearTimeout(touchTimer);
          });
          row.addEventListener("touchmove", () => {
            if (touchTimer) clearTimeout(touchTimer);
          });
        });

        // Bind visibility toggle
        const visToggle = view.querySelector(".visibility-toggle");
        if (visToggle) {
          visToggle.addEventListener("click", async (e) => {
            e.stopPropagation();
            e.preventDefault();
            const repo = e.currentTarget.dataset.repo;
            const isPrivate = e.currentTarget.dataset.private === "true";
            try {
              await ghFetch(`/repos/${USERNAME}/${repo}`, {
                method: "PATCH",
                body: JSON.stringify({ private: !isPrivate }),
              });
              toast(
                `Viditelnost zmƒõnƒõna na ${!isPrivate ? "Private" : "Public"}`,
              );
              await loadRepos();
              openRepo(repo, path);
            } catch (err) {
              toast("Chyba p≈ôi zmƒõnƒõ viditelnosti: " + err.message, "error");
            }
          });
        }

        // Bind description edit
        const descEl = view.querySelector(".desc");
        if (descEl) {
          descEl.addEventListener("click", (e) => {
            e.stopPropagation();
            e.preventDefault();
            const repo = e.currentTarget.dataset.repo;
            const currentDesc = e.currentTarget.dataset.desc;
            document.getElementById("editDescInput").value = currentDesc;
            document.getElementById("editDescModal").style.display = "flex";
            document.getElementById("editDescInput").focus();

            // Store for later
            window.EDIT_DESC_REPO = repo;
            window.EDIT_DESC_PATH = path;
          });
        }

        // Bind checkbox selection
        const selectAllCb = document.getElementById("selectAllCheckbox");
        const rowCheckboxes = view.querySelectorAll(".row-checkbox");
        const selectAllBtn = document.getElementById("selectAllBtn");
        const deselectAllBtn = document.getElementById("deselectAllBtn");

        function updateSelectionUI() {
          const checkedCount = Array.from(rowCheckboxes).filter(
            (cb) => cb.checked,
          ).length;
          if (checkedCount > 0) {
            deselectAllBtn.style.display = "inline-flex";
            selectAllBtn.style.display = "none";
            selectAllCb.checked = checkedCount === rowCheckboxes.length;
          } else {
            deselectAllBtn.style.display = "none";
            selectAllBtn.style.display = "inline-flex";
            selectAllCb.checked = false;
          }
        }

        selectAllCb.addEventListener("change", () => {
          rowCheckboxes.forEach((cb) => (cb.checked = selectAllCb.checked));
          updateSelectionUI();
        });

        selectAllBtn.addEventListener("click", () => {
          rowCheckboxes.forEach((cb) => (cb.checked = true));
          selectAllCb.checked = true;
          updateSelectionUI();
        });

        deselectAllBtn.addEventListener("click", () => {
          rowCheckboxes.forEach((cb) => (cb.checked = false));
          selectAllCb.checked = false;
          updateSelectionUI();
        });

        rowCheckboxes.forEach((cb) => {
          cb.addEventListener("change", (e) => {
            e.stopPropagation();
            updateSelectionUI();
          });
          // Zabr√°nit kliknut√≠ na checkbox od otev≈ôen√≠ souboru
          cb.addEventListener("click", (e) => {
            e.stopPropagation();
          });
        });

        // Upload button
        const uploadBtn = document.getElementById("uploadFilesBtn");
        if (uploadBtn) {
          uploadBtn.addEventListener("click", () => {
            openFileUploadDialog(repoName, path);
          });
        }
      }

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      //  OPEN FILE (not context menu)
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      function openFile(name, path, repo) {
        const isHtml = /\.html?$/i.test(name);

        if (isHtml) {
          // Otev≈ô√≠t HTML soubor v nov√©m tabu s GitHub Pages URL
          const githubPagesUrl = `https://${USERNAME}.github.io/${repo}/${path}`;
          window.open(githubPagesUrl, "_blank");
          toast(`Otev√≠r√°m ${name} v nov√©m tabu...`);
        } else {
          // Pro ostatn√≠ soubory zobrazit kontextov√© menu
          openFileContext(name, path, "file", 0, repo);
        }
      }

      function showHomeView() {
        CURRENT_REPO = null;
        CURRENT_PATH = "";
        renderRepoList();
        document.getElementById("fileToolbar").style.display = "none";
        document.getElementById("breadcrumb").innerHTML =
          '<span class="active">üè† Home</span>';

        const view = document.getElementById("repoView");
        if (!REPOS.length) {
          view.innerHTML = `<div class="empty-state"><div class="big">üöÄ</div><p>Nem√°≈° ≈æ√°dn√© repozit√°≈ô. Klikni <strong>+</strong> a vytvo≈ô prvn√≠!</p></div>`;
          return;
        }
        view.innerHTML = `
        <div class="repo-header"><div><h3>üëã Ahoj, ${USERNAME}!</h3><div class="desc">Tvoje repozit√°≈ôe</div></div></div>
        <table class="file-table">
          <thead><tr><th>Repozit√°≈ô</th><th>Viditelnost</th><th>Popis</th><th>Aktualizov√°n</th></tr></thead>
          <tbody>
            ${REPOS.map(
              (r) => `
              <tr class="repo-row" data-repo="${r.name}" style="cursor:pointer;">
                <td><span class="icon">üìÅ</span><span class="folder-name">${r.name}</span></td>
                <td><span class="visibility ${r.private ? "priv" : "pub"}">${r.private ? "üîí Private" : "üåê Public"}</span></td>
                <td class="meta">${r.description || "‚Äî"}</td>
                <td class="meta">${new Date(r.updated_at).toLocaleDateString("cs-CZ")}</td>
              </tr>
            `,
            ).join("")}
          </tbody>
        </table>
      `;

        // Bind events na repo rows
        view.querySelectorAll(".repo-row").forEach((row) => {
          // Lev√Ω klik - otev≈ô√≠t repo
          row.addEventListener("click", () => {
            openRepo(row.dataset.repo);
          });

          // Prav√Ω klik - context menu
          row.addEventListener("contextmenu", (e) => {
            e.preventDefault();
            openRepoContext(row.dataset.repo);
          });

          // Touch podpora (dlouh√Ω stisk) pro mobil
          let touchTimer = null;
          row.addEventListener("touchstart", (e) => {
            touchTimer = setTimeout(() => {
              e.preventDefault();
              openRepoContext(row.dataset.repo);
            }, 500);
          });
          row.addEventListener("touchend", () => {
            if (touchTimer) clearTimeout(touchTimer);
          });
          row.addEventListener("touchmove", () => {
            if (touchTimer) clearTimeout(touchTimer);
          });
        });
      }

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      //  NEW REPO
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      document.getElementById("newRepoBtn").onclick = () => {
        document.getElementById("newRepoName").value = "";
        document.getElementById("newRepoDesc").value = "";
        document.getElementById("newRepoModal").style.display = "flex";
      };
      document.getElementById("cancelNewRepo").onclick = () => {
        document.getElementById("newRepoModal").style.display = "none";
      };
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      //  NEW FILE/FOLDER
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      document.getElementById("newFileBtn").onclick = () => {
        if (!CURRENT_REPO) return;
        document.getElementById("newFileModal").style.display = "flex";
        document.getElementById("newItemName").value = "";
        document.getElementById("newFileContent").value = "";
        document.getElementById("newItemType").value = "file";
        document.getElementById("fileContentSection").style.display = "block";
        document.getElementById("newItemName").focus();
      };

      document.getElementById("newItemType").addEventListener("change", (e) => {
        const isFolder = e.target.value === "folder";
        document.getElementById("fileContentSection").style.display = isFolder
          ? "none"
          : "block";
        document.getElementById("newItemName").placeholder = isFolder
          ? "nazev-slozky/"
          : "nazev.txt";
      });

      document.getElementById("cancelNewItem").onclick = () => {
        document.getElementById("newFileModal").style.display = "none";
      };

      document.getElementById("confirmNewItem").onclick = async () => {
        const type = document.getElementById("newItemType").value;
        let name = document.getElementById("newItemName").value.trim();
        const content = document.getElementById("newFileContent").value;

        if (!name) {
          toast("Zadej n√°zev", "error");
          return;
        }

        try {
          if (type === "folder") {
            // GitHub nem√° pr√°zdn√© slo≈æky, vytvo≈ô√≠me .gitkeep
            if (!name.endsWith("/")) name += "/";
            const filePath = CURRENT_PATH
              ? `${CURRENT_PATH}/${name}.gitkeep`
              : `${name}.gitkeep`;
            await ghFetch(
              `/repos/${USERNAME}/${CURRENT_REPO}/contents/${filePath}`,
              {
                method: "PUT",
                body: JSON.stringify({
                  message: `Create folder: ${name}`,
                  content: btoa(""),
                }),
              },
            );
            toast(`Slo≈æka "${name}" vytvo≈ôena`);
          } else {
            // Vytvo≈ôit soubor
            const filePath = CURRENT_PATH ? `${CURRENT_PATH}/${name}` : name;
            await ghFetch(
              `/repos/${USERNAME}/${CURRENT_REPO}/contents/${filePath}`,
              {
                method: "PUT",
                body: JSON.stringify({
                  message: `Create file: ${name}`,
                  content: btoa(unescape(encodeURIComponent(content || ""))),
                }),
              },
            );
            toast(`Soubor "${name}" vytvo≈ôen`);
          }

          document.getElementById("newFileModal").style.display = "none";
          openRepo(CURRENT_REPO, CURRENT_PATH);
        } catch (e) {
          toast("Chyba p≈ôi vytv√°≈ôen√≠: " + e.message, "error");
        }
      };

      // Close modal on overlay click
      document.getElementById("newFileModal").addEventListener("click", (e) => {
        if (e.target === document.getElementById("newFileModal")) {
          document.getElementById("newFileModal").style.display = "none";
        }
      });

      document.getElementById("confirmNewRepo").onclick = async () => {
        const name = document.getElementById("newRepoName").value.trim();
        if (!name) return toast("Zad√°≈° n√°zev repozit√°≈ôe.", "error");

        const payload = {
          name,
          description: document.getElementById("newRepoDesc").value.trim(),
          private:
            document.getElementById("newRepoVisibility").value === "true",
          auto_init: document.getElementById("newRepoReadme").checked,
        };

        try {
          await ghFetch("/user/repos", {
            method: "POST",
            body: JSON.stringify(payload),
          });
          document.getElementById("newRepoModal").style.display = "none";
          toast("Repozit√°≈ô ‚Äû" + name + '" vytvo≈ôen!');
          await loadRepos();
          openRepo(name);
        } catch (e) {
          toast("Chyba: " + e.message, "error");
        }
      };

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      //  DELETE REPO
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      function openDeleteModal(name) {
        DELETE_TARGET = name;
        const lastTwo = name.slice(-2);
        document.getElementById("deleteRepoNameShow").textContent = name;
        document.getElementById("deleteHintLetters").textContent = lastTwo;
        document.getElementById("deleteRepoConfirm").value = "";
        document.getElementById("confirmDeleteRepo").disabled = true;
        document.getElementById("deleteRepoModal").style.display = "flex";
        document.getElementById("deleteRepoConfirm").focus();
      }
      document.getElementById("cancelDeleteRepo").onclick = () => {
        document.getElementById("deleteRepoModal").style.display = "none";
      };
      document.getElementById("deleteRepoConfirm").oninput = function () {
        document.getElementById("confirmDeleteRepo").disabled =
          this.value.trim() !== DELETE_TARGET.slice(-2);
      };
      document.getElementById("confirmDeleteRepo").onclick = async () => {
        try {
          await ghFetch(`/repos/${USERNAME}/${DELETE_TARGET}`, {
            method: "DELETE",
          });
          document.getElementById("deleteRepoModal").style.display = "none";
          toast("Repozit√°≈ô ‚Äû" + DELETE_TARGET + '" smaz√°n.');
          await loadRepos();
          showHomeView();
        } catch (e) {
          toast("Chyba p≈ôi maz√°n√≠: " + e.message, "error");
        }
      };

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      //  HELPERS
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      function formatBytes(bytes) {
        if (!bytes) return "0 B";
        const k = 1024;
        const sizes = ["B", "KB", "MB"];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + " " + sizes[i];
      }

      function getFileIcon(name) {
        const ext = name.split(".").pop().toLowerCase();
        const icons = {
          html: "üåê",
          css: "üé®",
          js: "‚ö°",
          ts: "üíé",
          json: "üìã",
          md: "üìù",
          png: "üñºÔ∏è",
          jpg: "üñºÔ∏è",
          jpeg: "üñºÔ∏è",
          gif: "üñºÔ∏è",
          svg: "üñºÔ∏è",
          py: "üêç",
          rb: "üíé",
          java: "‚òï",
          txt: "üìÑ",
          yml: "‚öôÔ∏è",
          yaml: "‚öôÔ∏è",
          gitignore: "üôà",
          env: "üîê",
          lock: "üîí",
          xml: "üìã",
          csv: "üìä",
        };
        return icons[ext] || "üìÑ";
      }

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      //  BACKUP (download all repos as ZIP)
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      let BACKUP_CANCELLED = false;

      document.getElementById("backupBtn").onclick = () => {
        if (!REPOS.length)
          return toast("Nem√°≈° ≈æ√°dn√© repozit√°≈ô na st√°hnout√≠.", "error");
        BACKUP_CANCELLED = false;
        document.getElementById("backupModal").style.display = "flex";
        document.getElementById("backupProgressBar").style.width = "0%";
        document.getElementById("backupPercent").textContent = "0%";
        document.getElementById("backupStatus").textContent = "Zaƒç√≠n√°...";
        document.getElementById("backupRepoList").innerHTML = REPOS.map(
          (r) =>
            `<div id="backupItem-${r.name}" style="display:flex; align-items:center; gap:8px; padding:5px 0; border-bottom:1px solid var(--border); font-size:12px;">
          <span id="backupIcon-${r.name}" style="width:16px; text-align:center;">‚è≥</span>
          <span style="flex:1; color:var(--text);">${r.name}</span>
          <span id="backupCount-${r.name}" style="color:var(--text-dim); font-size:11px;">‚Äî</span>
        </div>`,
        ).join("");
        startBackup();
      };

      document.getElementById("cancelBackup").onclick = () => {
        BACKUP_CANCELLED = true;
        document.getElementById("backupModal").style.display = "none";
        toast("Backup zru≈°en.");
      };

      // ‚îÄ‚îÄ recursively fetch all files in a repo ‚îÄ‚îÄ
      async function fetchAllFiles(repoName, path = "") {
        const endpoint = path
          ? `/repos/${USERNAME}/${repoName}/contents/${path}`
          : `/repos/${USERNAME}/${repoName}/contents`;
        const items = await ghFetch(endpoint);
        let files = [];
        for (const item of items) {
          if (BACKUP_CANCELLED) return [];
          if (item.type === "dir") {
            const sub = await fetchAllFiles(repoName, item.path);
            files = files.concat(sub);
          } else {
            // fetch file content (base64)
            const fileData = await ghFetch(
              `/repos/${USERNAME}/${repoName}/contents/${item.path}`,
            );
            files.push({
              path: repoName + "/" + item.path,
              content: fileData.content,
            });
          }
        }
        return files;
      }

      async function startBackup() {
        const totalRepos = REPOS.length;
        let allFiles = [];

        for (let i = 0; i < totalRepos; i++) {
          if (BACKUP_CANCELLED) return;
          const repo = REPOS[i];
          document.getElementById("backupStatus").textContent =
            `Stahuje: ${repo.name}...`;
          document.getElementById("backupIcon-" + repo.name).textContent = "üì•";

          try {
            const files = await fetchAllFiles(repo.name);
            if (BACKUP_CANCELLED) return;
            allFiles = allFiles.concat(files);
            document.getElementById("backupIcon-" + repo.name).textContent =
              "‚úÖ";
            document.getElementById("backupCount-" + repo.name).textContent =
              files.length + " soubor" + (files.length === 1 ? "" : "≈Ø");
          } catch (e) {
            document.getElementById("backupIcon-" + repo.name).textContent =
              "‚ùå";
            document.getElementById("backupCount-" + repo.name).textContent =
              "chyba";
          }

          const pct = Math.round(((i + 1) / totalRepos) * 100);
          document.getElementById("backupProgressBar").style.width = pct + "%";
          document.getElementById("backupPercent").textContent = pct + "%";
        }

        if (BACKUP_CANCELLED) return;

        // build ZIP and download
        document.getElementById("backupStatus").textContent = "Bal√≠ do ZIP...";
        const zipBlob = buildZip(allFiles);
        downloadBlob(
          zipBlob,
          `github-backup-${USERNAME}-${new Date().toISOString().slice(0, 10)}.zip`,
        );
        document.getElementById("backupModal").style.display = "none";
        toast(
          `Backup hotov ‚Äì ${allFiles.length} soubor` +
            (allFiles.length === 1 ? "" : "≈Ø") +
            ` v ZIP.`,
        );
      }

      // ‚îÄ‚îÄ manual ZIP builder (no external library) ‚îÄ‚îÄ
      function buildZip(files) {
        const localHeaders = [];
        const centralHeaders = [];
        let offset = 0;

        for (const file of files) {
          const nameBytes = new TextEncoder().encode(file.path);
          const contentBytes = Uint8Array.from(atob(file.content), (c) =>
            c.charCodeAt(0),
          );
          const crc = crc32(contentBytes);

          // Local file header
          const local = new Uint8Array(30 + nameBytes.length);
          const localView = new DataView(local.buffer);
          localView.setUint32(0, 0x04034b50, true); // signature
          localView.setUint16(4, 20, true); // version needed
          localView.setUint16(6, 0, true); // flags
          localView.setUint16(8, 0, true); // compression = stored
          localView.setUint16(10, 0, true); // mod time
          localView.setUint16(12, 0, true); // mod date
          localView.setUint32(14, crc, true); // crc32
          localView.setUint32(18, contentBytes.length, true); // compressed size
          localView.setUint32(22, contentBytes.length, true); // uncompressed size
          localView.setUint16(26, nameBytes.length, true); // filename length
          localView.setUint16(28, 0, true); // extra field length
          local.set(nameBytes, 30);
          localHeaders.push({
            header: local,
            content: contentBytes,
            nameBytes,
            crc,
            offset,
          });

          // Central directory header
          const central = new Uint8Array(46 + nameBytes.length);
          const centralView = new DataView(central.buffer);
          centralView.setUint32(0, 0x02014b50, true); // signature
          centralView.setUint16(4, 20, true); // version made by
          centralView.setUint16(6, 20, true); // version needed
          centralView.setUint16(8, 0, true); // flags
          centralView.setUint16(10, 0, true); // compression
          centralView.setUint16(12, 0, true); // mod time
          centralView.setUint16(14, 0, true); // mod date
          centralView.setUint32(16, crc, true); // crc32
          centralView.setUint32(20, contentBytes.length, true);
          centralView.setUint32(24, contentBytes.length, true);
          centralView.setUint16(28, nameBytes.length, true);
          centralView.setUint16(30, 0, true); // extra length
          centralView.setUint16(32, 0, true); // comment length
          centralView.setUint16(34, 0, true); // disk number
          centralView.setUint16(36, 0, true); // internal attr
          centralView.setUint32(38, 0, true); // external attr
          centralView.setUint32(42, offset, true); // local header offset
          central.set(nameBytes, 46);
          centralHeaders.push(central);

          offset += local.length + contentBytes.length;
        }

        // End of central directory
        let centralSize = 0;
        centralHeaders.forEach((c) => (centralSize += c.length));
        const eocd = new Uint8Array(22);
        const eocdView = new DataView(eocd.buffer);
        eocdView.setUint32(0, 0x06054b50, true);
        eocdView.setUint16(4, 0, true);
        eocdView.setUint16(6, 0, true);
        eocdView.setUint16(8, files.length, true);
        eocdView.setUint16(10, files.length, true);
        eocdView.setUint32(12, centralSize, true);
        eocdView.setUint32(16, offset, true);
        eocdView.setUint16(20, 0, true);

        // Concatenate everything
        const totalSize = offset + centralSize + eocd.length;
        const zip = new Uint8Array(totalSize);
        let pos = 0;
        localHeaders.forEach(({ header, content }) => {
          zip.set(header, pos);
          pos += header.length;
          zip.set(content, pos);
          pos += content.length;
        });
        centralHeaders.forEach((c) => {
          zip.set(c, pos);
          pos += c.length;
        });
        zip.set(eocd, pos);

        return new Blob([zip], { type: "application/zip" });
      }

      // ‚îÄ‚îÄ CRC32 ‚îÄ‚îÄ
      function crc32(buf) {
        let crc = 0xffffffff;
        for (let i = 0; i < buf.length; i++) {
          crc = crc ^ buf[i];
          for (let j = 0; j < 8; j++) {
            crc = (crc >>> 1) ^ (crc & 1 ? 0xedb88320 : 0);
          }
        }
        return (crc ^ 0xffffffff) >>> 0;
      }

      // ‚îÄ‚îÄ trigger browser download ‚îÄ‚îÄ
      function downloadBlob(blob, filename) {
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      //  REPO CONTEXT MENU
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      function openRepoContext(repoName) {
        const repo = REPOS.find((r) => r.name === repoName);
        if (!repo) return;

        document.getElementById("repoCtxName").textContent = repoName;
        document.getElementById("repoCtxMeta").textContent = repo.private
          ? "üîí Private"
          : "üåê Public";
        document.getElementById("repoCtxModal").style.display = "flex";

        // Rename button
        document.getElementById("repoCtxRename").onclick = () => {
          document.getElementById("repoCtxModal").style.display = "none";
          const newName = prompt(
            `P≈ôejmenovat repozit√°≈ô "${repoName}" na:`,
            repoName,
          );
          if (newName && newName !== repoName) {
            renameRepo(repoName, newName);
          }
        };

        // Delete button
        document.getElementById("repoCtxDelete").onclick = () => {
          document.getElementById("repoCtxModal").style.display = "none";
          openDeleteModal(repoName);
        };
      }

      // Close repo context modal on overlay click
      document.getElementById("repoCtxModal").addEventListener("click", (e) => {
        if (e.target === document.getElementById("repoCtxModal")) {
          document.getElementById("repoCtxModal").style.display = "none";
        }
      });

      async function renameRepo(oldName, newName) {
        try {
          await ghFetch(`/repos/${USERNAME}/${oldName}`, {
            method: "PATCH",
            body: JSON.stringify({ name: newName }),
          });
          toast(`Repozit√°≈ô p≈ôejmenov√°n na "${newName}"`);
          await loadRepos();
          if (CURRENT_REPO === oldName) {
            openRepo(newName, CURRENT_PATH);
          } else {
            showHomeView();
          }
        } catch (e) {
          toast("Chyba p≈ôi p≈ôejmenov√°n√≠: " + e.message, "error");
        }
      }

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      //  EDIT DESCRIPTION MODAL
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      document.getElementById("cancelEditDesc").onclick = () => {
        document.getElementById("editDescModal").style.display = "none";
      };

      document.getElementById("confirmEditDesc").onclick = async () => {
        const newDesc = document.getElementById("editDescInput").value.trim();
        const repo = window.EDIT_DESC_REPO;
        const path = window.EDIT_DESC_PATH;

        try {
          await ghFetch(`/repos/${USERNAME}/${repo}`, {
            method: "PATCH",
            body: JSON.stringify({ description: newDesc }),
          });
          document.getElementById("editDescModal").style.display = "none";
          toast("Popis aktualizov√°n");
          await loadRepos();
          openRepo(repo, path);
        } catch (e) {
          toast("Chyba p≈ôi √∫pravƒõ popisu: " + e.message, "error");
        }
      };

      document
        .getElementById("editDescModal")
        .addEventListener("click", (e) => {
          if (e.target === document.getElementById("editDescModal")) {
            document.getElementById("editDescModal").style.display = "none";
          }
        });

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      //  FILE VIEWER MODAL
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      let VIEWER_FILE = {};
      let VIEWER_ORIGINAL_CONTENT = "";
      let VIEWER_SEARCH_MATCHES = [];
      let VIEWER_CURRENT_MATCH = -1;

      async function openFileViewer(name, path, repo) {
        VIEWER_FILE = { name, path, repo };
        VIEWER_SEARCH_MATCHES = [];
        VIEWER_CURRENT_MATCH = -1;

        document.getElementById("viewerFileName").textContent = name;
        document.getElementById("viewerFileMeta").textContent =
          `${repo}/${path}`;
        document.getElementById("viewerFileIcon").textContent =
          getFileIcon(name);
        document.getElementById("fileViewerModal").style.display = "flex";
        document.getElementById("fileViewerContent").textContent = "Naƒç√≠t√°m...";
        document.getElementById("searchInput").value = "";
        document.getElementById("replaceInput").value = "";
        document.getElementById("replaceControls").style.display = "none";
        document.getElementById("searchCounter").textContent = "";

        try {
          const fileData = await ghFetch(
            `/repos/${USERNAME}/${repo}/contents/${path}`,
          );

          // Spr√°vn√© dek√≥dov√°n√≠ UTF-8 (podpora ƒçesk√Ωch znak≈Ø)
          const binaryString = atob(fileData.content);
          const bytes = new Uint8Array(binaryString.length);
          for (let i = 0; i < binaryString.length; i++) {
            bytes[i] = binaryString.charCodeAt(i);
          }
          const content = new TextDecoder("utf-8").decode(bytes);

          VIEWER_ORIGINAL_CONTENT = content;
          document.getElementById("fileViewerContent").textContent = content;
          document.getElementById("viewerFileMeta").textContent =
            formatBytes(content.length) +
            " ¬∑ " +
            name.split(".").pop().toUpperCase();
        } catch (e) {
          document.getElementById("fileViewerContent").textContent =
            "Chyba p≈ôi naƒç√≠t√°n√≠: " + e.message;
        }
      }

      // Search functionality
      function performSearch() {
        const searchTerm = document.getElementById("searchInput").value;
        const content = VIEWER_ORIGINAL_CONTENT;
        const contentEl = document.getElementById("fileViewerContent");

        if (!searchTerm) {
          contentEl.textContent = content;
          document.getElementById("searchCounter").textContent = "";
          VIEWER_SEARCH_MATCHES = [];
          VIEWER_CURRENT_MATCH = -1;
          return;
        }

        // Find all matches
        VIEWER_SEARCH_MATCHES = [];
        let index = 0;
        while ((index = content.indexOf(searchTerm, index)) !== -1) {
          VIEWER_SEARCH_MATCHES.push(index);
          index += searchTerm.length;
        }

        if (VIEWER_SEARCH_MATCHES.length === 0) {
          document.getElementById("searchCounter").textContent = "Nenalezeno";
          contentEl.textContent = content;
          VIEWER_CURRENT_MATCH = -1;
          return;
        }

        VIEWER_CURRENT_MATCH = 0;
        highlightMatches();
      }

      function highlightMatches() {
        const searchTerm = document.getElementById("searchInput").value;
        const content = VIEWER_ORIGINAL_CONTENT;
        const contentEl = document.getElementById("fileViewerContent");

        if (VIEWER_SEARCH_MATCHES.length === 0) return;

        // Build HTML with highlighted matches
        let html = "";
        let lastIndex = 0;

        VIEWER_SEARCH_MATCHES.forEach((matchIndex, i) => {
          // Add text before match
          html += escapeHtml(content.substring(lastIndex, matchIndex));

          // Add highlighted match
          const isCurrent = i === VIEWER_CURRENT_MATCH;
          const style = isCurrent
            ? "background: var(--accent); color: var(--bg); font-weight: 700;"
            : "background: var(--yellow); color: var(--bg);";
          html += `<mark style="${style}">${escapeHtml(content.substring(matchIndex, matchIndex + searchTerm.length))}</mark>`;

          lastIndex = matchIndex + searchTerm.length;
        });

        // Add remaining text
        html += escapeHtml(content.substring(lastIndex));

        contentEl.innerHTML = html;
        document.getElementById("searchCounter").textContent =
          `${VIEWER_CURRENT_MATCH + 1} z ${VIEWER_SEARCH_MATCHES.length}`;

        // Scroll to current match
        const marks = contentEl.querySelectorAll("mark");
        if (marks[VIEWER_CURRENT_MATCH]) {
          marks[VIEWER_CURRENT_MATCH].scrollIntoView({
            behavior: "smooth",
            block: "center",
          });
        }
      }

      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      function findNext() {
        if (VIEWER_SEARCH_MATCHES.length === 0) return;
        VIEWER_CURRENT_MATCH =
          (VIEWER_CURRENT_MATCH + 1) % VIEWER_SEARCH_MATCHES.length;
        highlightMatches();
      }

      function findPrevious() {
        if (VIEWER_SEARCH_MATCHES.length === 0) return;
        VIEWER_CURRENT_MATCH =
          (VIEWER_CURRENT_MATCH - 1 + VIEWER_SEARCH_MATCHES.length) %
          VIEWER_SEARCH_MATCHES.length;
        highlightMatches();
      }

      function replaceCurrentMatch() {
        const searchTerm = document.getElementById("searchInput").value;
        const replaceTerm = document.getElementById("replaceInput").value;

        if (!searchTerm || VIEWER_SEARCH_MATCHES.length === 0) {
          toast("Nejprve vyhledej text", "error");
          return;
        }

        const matchIndex = VIEWER_SEARCH_MATCHES[VIEWER_CURRENT_MATCH];
        VIEWER_ORIGINAL_CONTENT =
          VIEWER_ORIGINAL_CONTENT.substring(0, matchIndex) +
          replaceTerm +
          VIEWER_ORIGINAL_CONTENT.substring(matchIndex + searchTerm.length);

        document.getElementById("fileViewerContent").textContent =
          VIEWER_ORIGINAL_CONTENT;
        toast("Nahrazeno 1 v√Ωskyt");

        // Re-search
        performSearch();
      }

      function replaceAllMatches() {
        const searchTerm = document.getElementById("searchInput").value;
        const replaceTerm = document.getElementById("replaceInput").value;

        if (!searchTerm || VIEWER_SEARCH_MATCHES.length === 0) {
          toast("Nejprve vyhledej text", "error");
          return;
        }

        const count = VIEWER_SEARCH_MATCHES.length;
        VIEWER_ORIGINAL_CONTENT =
          VIEWER_ORIGINAL_CONTENT.split(searchTerm).join(replaceTerm);
        document.getElementById("fileViewerContent").textContent =
          VIEWER_ORIGINAL_CONTENT;

        toast(`Nahrazeno ${count} v√Ωskyt${count > 1 ? "≈Ø" : ""}`);

        // Clear search
        document.getElementById("searchInput").value = "";
        VIEWER_SEARCH_MATCHES = [];
        VIEWER_CURRENT_MATCH = -1;
        document.getElementById("searchCounter").textContent = "";
      }

      // Event listeners for search
      document
        .getElementById("searchInput")
        .addEventListener("input", performSearch);
      document
        .getElementById("searchInput")
        .addEventListener("keydown", (e) => {
          if (e.key === "Enter") {
            if (e.shiftKey) {
              findPrevious();
            } else {
              findNext();
            }
          }
        });
      document.getElementById("findNextBtn").onclick = findNext;
      document.getElementById("findPrevBtn").onclick = findPrevious;
      document.getElementById("toggleReplaceBtn").onclick = () => {
        const controls = document.getElementById("replaceControls");
        controls.style.display =
          controls.style.display === "none" ? "flex" : "none";
      };
      document.getElementById("replaceBtn").onclick = replaceCurrentMatch;
      document.getElementById("replaceAllBtn").onclick = replaceAllMatches;

      // Save file changes
      document.getElementById("saveFileBtn").onclick = async () => {
        try {
          const content =
            document.getElementById("fileViewerContent").textContent;
          const base64Content = btoa(unescape(encodeURIComponent(content)));

          await ghFetch(
            `/repos/${USERNAME}/${VIEWER_FILE.repo}/contents/${VIEWER_FILE.path}`,
            {
              method: "PUT",
              body: JSON.stringify({
                message: `Update: ${VIEWER_FILE.name}`,
                content: base64Content,
                sha: VIEWER_FILE_SHA,
              }),
            },
          );

          toast("Soubor ulo≈æen!");
          VIEWER_IS_MODIFIED = false;
          document.getElementById("saveFileBtn").style.display = "none";
          document.getElementById("fileViewerModal").style.display = "none";

          // Refresh current folder
          if (CURRENT_REPO) {
            openRepo(CURRENT_REPO, CURRENT_PATH);
          }
        } catch (e) {
          toast("Chyba p≈ôi ukl√°d√°n√≠: " + e.message, "error");
        }
      };

      // Sledov√°n√≠ zmƒõn v obsahu
      document
        .getElementById("fileViewerContent")
        .addEventListener("input", () => {
          VIEWER_IS_MODIFIED = true;
          // Zobrazit tlaƒç√≠tko Ulo≈æit kdy≈æ jsou zmƒõny
          document.getElementById("saveFileBtn").style.display = "inline-block";
        });

      document.getElementById("closeFileViewer").onclick = () => {
        if (
          VIEWER_IS_MODIFIED &&
          !confirm("M√°≈° neulo≈æen√© zmƒõny. Opravdu zav≈ô√≠t?")
        ) {
          return;
        }
        document.getElementById("fileViewerModal").style.display = "none";
      };

      document.getElementById("downloadFromViewer").onclick = async () => {
        try {
          const fileData = await ghFetch(
            `/repos/${USERNAME}/${VIEWER_FILE.repo}/contents/${VIEWER_FILE.path}`,
          );
          const bytes = Uint8Array.from(atob(fileData.content), (c) =>
            c.charCodeAt(0),
          );
          const blob = new Blob([bytes]);
          downloadBlob(blob, VIEWER_FILE.name);
          toast("Soubor st√°hnut");
        } catch (e) {
          toast("Chyba p≈ôi st√°hnut√≠: " + e.message, "error");
        }
      };

      document
        .getElementById("fileViewerModal")
        .addEventListener("click", (e) => {
          if (e.target === document.getElementById("fileViewerModal")) {
            document.getElementById("fileViewerModal").style.display = "none";
          }
        });

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      //  FILE CONTEXT MENU
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      let CTX_FILE = {}; // { name, path, type, size, repo }

      function openFileContext(name, path, type, size, repo) {
        CTX_FILE = { name, path, type, size, repo };
        const isDir = type === "dir";
        const isHtml = /\.html?$/i.test(name);
        const ext = name.split(".").pop().toLowerCase();
        const isTextFile = [
          "txt",
          "md",
          "json",
          "js",
          "ts",
          "css",
          "html",
          "xml",
          "yml",
          "yaml",
          "py",
          "java",
          "rb",
          "php",
          "c",
          "cpp",
          "h",
          "cs",
          "go",
          "rs",
          "kt",
          "swift",
        ].includes(ext);

        document.getElementById("ctxFileName").textContent = name;
        document.getElementById("ctxFileMeta").textContent = isDir
          ? "Slo≈æka"
          : formatBytes(size) + " ¬∑ " + name.split(".").pop().toUpperCase();
        document.getElementById("ctxFileIcon").textContent = isDir
          ? "üìÇ"
          : getFileIcon(name);

        // hide rename row
        document.getElementById("renameRow").classList.remove("show");

        // build action buttons
        let btns = "";
        if (isHtml) {
          btns += `<button class="ctx-btn" id="ctxPreview">
          <span class="ctx-icon">üåê</span>
          <div><div class="ctx-label">Spustit v browseru</div><div class="ctx-desc">Otev≈ôe HTML str√°nku v nov√©m tabu</div></div>
        </button>`;
        }
        if (!isDir && isTextFile) {
          btns += `<button class="ctx-btn" id="ctxView">
          <span class="ctx-icon">üëÅÔ∏è</span>
          <div><div class="ctx-label">Zobrazit obsah</div><div class="ctx-desc">Otev≈ôe soubor v prohl√≠≈æeƒçi</div></div>
        </button>`;
        }
        if (!isDir) {
          btns += `<button class="ctx-btn" id="ctxDownload">
          <span class="ctx-icon">‚¨áÔ∏è</span>
          <div><div class="ctx-label">St√°hnout soubor</div><div class="ctx-desc">Ulo≈æ√≠ soubor na tv≈Øj poƒç√≠taƒç</div></div>
        </button>`;
        }
        btns += `<button class="ctx-btn" id="ctxRename">
        <span class="ctx-icon">‚úèÔ∏è</span>
        <div><div class="ctx-label">P≈ôejmenovat</div><div class="ctx-desc">Zmƒõni n√°zev ${isDir ? "slo≈æky" : "souboru"}</div></div>
      </button>`;
        btns += `<button class="ctx-btn danger" id="ctxDelete">
        <span class="ctx-icon">üóëÔ∏è</span>
        <div><div class="ctx-label" style="color:var(--red);">Smazat</div><div class="ctx-desc">Nav≈ædy smaz√° ${isDir ? "slo≈æku a v≈°e uvnit≈ô" : "tento soubor"}</div></div>
      </button>`;

        document.getElementById("ctxActions").innerHTML = btns;
        document.getElementById("ctxModal").style.display = "flex";

        // ‚îÄ‚îÄ bind action handlers ‚îÄ‚îÄ

        // Preview HTML - open in GitHub Pages
        const previewBtn = document.getElementById("ctxPreview");
        if (previewBtn) {
          previewBtn.onclick = () => {
            // Otev≈ô√≠t v GitHub Pages
            const githubPagesUrl = `https://${USERNAME}.github.io/${CTX_FILE.repo}/${CTX_FILE.path}`;
            window.open(githubPagesUrl, "_blank");
            document.getElementById("ctxModal").style.display = "none";
            toast(`Otev√≠r√°m ${CTX_FILE.name} v GitHub Pages...`);
          };
        }

        // View file content
        const viewBtn = document.getElementById("ctxView");
        if (viewBtn) {
          viewBtn.onclick = () => {
            document.getElementById("ctxModal").style.display = "none";
            openFileViewer(CTX_FILE.name, CTX_FILE.path, CTX_FILE.repo);
          };
        }

        // Download
        const dlBtn = document.getElementById("ctxDownload");
        if (dlBtn) {
          dlBtn.onclick = async () => {
            try {
              const fileData = await ghFetch(
                `/repos/${USERNAME}/${CTX_FILE.repo}/contents/${CTX_FILE.path}`,
              );
              const bytes = Uint8Array.from(atob(fileData.content), (c) =>
                c.charCodeAt(0),
              );
              const blob = new Blob([bytes]);
              downloadBlob(blob, CTX_FILE.name);
              document.getElementById("ctxModal").style.display = "none";
              toast("Soubor ‚Äû" + CTX_FILE.name + '" st√°hnut.');
            } catch (e) {
              toast("Chyba p≈ôi st√°hnut√≠: " + e.message, "error");
            }
          };
        }

        // Rename ‚Äì show input
        document.getElementById("ctxRename").onclick = () => {
          document.getElementById("renameRow").classList.add("show");
          document.getElementById("renameInput").value = CTX_FILE.name;
          document.getElementById("renameInput").focus();
          // select just the name part (before extension)
          const dotIdx = CTX_FILE.name.lastIndexOf(".");
          if (dotIdx > 0)
            document.getElementById("renameInput").setSelectionRange(0, dotIdx);
        };

        document.getElementById("cancelRename").onclick = () => {
          document.getElementById("renameRow").classList.remove("show");
        };

        document.getElementById("confirmRename").onclick = async () => {
          const newName = document.getElementById("renameInput").value.trim();
          if (!newName || newName === CTX_FILE.name)
            return toast("N√°zev nezmƒõnƒõn.", "error");
          // compute new path: replace last segment
          const parts = CTX_FILE.path.split("/");
          parts[parts.length - 1] = newName;
          const newPath = parts.join("/");
          try {
            // GitHub rename = get content ‚Üí delete old ‚Üí create new at new path
            const fileData = await ghFetch(
              `/repos/${USERNAME}/${CTX_FILE.repo}/contents/${CTX_FILE.path}`,
            );
            // delete old
            await ghFetch(
              `/repos/${USERNAME}/${CTX_FILE.repo}/contents/${CTX_FILE.path}`,
              {
                method: "DELETE",
                body: JSON.stringify({
                  message: `rename: ${CTX_FILE.name} ‚Üí ${newName}`,
                  sha: fileData.sha,
                }),
              },
            );
            // create new (only for files; folders can't be created empty on GitHub)
            if (CTX_FILE.type !== "dir") {
              await ghFetch(
                `/repos/${USERNAME}/${CTX_FILE.repo}/contents/${newPath}`,
                {
                  method: "POST",
                  body: JSON.stringify({
                    message: `rename: ${CTX_FILE.name} ‚Üí ${newName}`,
                    content: fileData.content,
                  }),
                },
              );
            }
            document.getElementById("ctxModal").style.display = "none";
            toast("P≈ôejmenov√°no na ‚Äû" + newName + '"');
            // refresh current folder
            openRepo(
              CTX_FILE.repo,
              CTX_FILE.path.split("/").slice(0, -1).join("/"),
            );
          } catch (e) {
            toast("Chyba p≈ôi p≈ôejmenov√°n√≠: " + e.message, "error");
          }
        };

        // Delete
        document.getElementById("ctxDelete").onclick = async () => {
          if (!confirm(`Smazat ‚Äû${CTX_FILE.name}"? Toto nelze vr√°tit.`)) return;
          try {
            if (CTX_FILE.type === "dir") {
              // folders: need to delete all files inside recursively
              await deleteDir(CTX_FILE.repo, CTX_FILE.path);
            } else {
              const fileData = await ghFetch(
                `/repos/${USERNAME}/${CTX_FILE.repo}/contents/${CTX_FILE.path}`,
              );
              await ghFetch(
                `/repos/${USERNAME}/${CTX_FILE.repo}/contents/${CTX_FILE.path}`,
                {
                  method: "DELETE",
                  body: JSON.stringify({
                    message: `delete: ${CTX_FILE.name}`,
                    sha: fileData.sha,
                  }),
                },
              );
            }
            document.getElementById("ctxModal").style.display = "none";
            toast("‚Äû" + CTX_FILE.name + '" smaz√°n.');
            openRepo(
              CTX_FILE.repo,
              CTX_FILE.path.split("/").slice(0, -1).join("/"),
            );
          } catch (e) {
            toast("Chyba p≈ôi maz√°n√≠: " + e.message, "error");
          }
        };
      }

      // recursively delete a folder (GitHub has no folder-delete endpoint)
      async function deleteDir(repo, dirPath) {
        const items = await ghFetch(
          `/repos/${USERNAME}/${repo}/contents/${dirPath}`,
        );
        for (const item of items) {
          if (item.type === "dir") {
            await deleteDir(repo, item.path);
          } else {
            await ghFetch(`/repos/${USERNAME}/${repo}/contents/${item.path}`, {
              method: "DELETE",
              body: JSON.stringify({
                message: `delete: ${item.path}`,
                sha: item.sha,
              }),
            });
          }
        }
      }

      // close context modal on overlay click
      document.getElementById("ctxModal").addEventListener("click", (e) => {
        if (e.target === document.getElementById("ctxModal")) {
          document.getElementById("ctxModal").style.display = "none";
        }
      });

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      //  REPO CONTEXT MENU
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      function openRepoContext(repoName) {
        const repo = REPOS.find((r) => r.name === repoName);
        if (!repo) return;

        document.getElementById("repoCtxName").textContent = repoName;
        document.getElementById("repoCtxMeta").textContent = repo.private
          ? "üîí Private"
          : "üåê Public";
        document.getElementById("repoCtxModal").style.display = "flex";

        // Rename handler
        document.getElementById("repoCtxRename").onclick = () => {
          document.getElementById("repoCtxModal").style.display = "none";
          const newName = prompt("Nov√Ω n√°zev repozit√°≈ôe:", repoName);
          if (!newName || newName === repoName) return;

          // GitHub API doesn't support repo rename, show message
          toast(
            "P≈ôejmenov√°n√≠ repozit√°≈ôe nen√≠ podporov√°no p≈ôes API. Udƒõlej to na GitHubu.",
            "error",
          );
        };

        // Delete handler
        document.getElementById("repoCtxDelete").onclick = () => {
          document.getElementById("repoCtxModal").style.display = "none";
          openDeleteModal(repoName);
        };
      }

      // Close repo context modal
      document.getElementById("repoCtxModal").addEventListener("click", (e) => {
        if (e.target === document.getElementById("repoCtxModal")) {
          document.getElementById("repoCtxModal").style.display = "none";
        }
      });

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      //  EDIT DESCRIPTION HANDLERS
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      document.getElementById("cancelEditDesc").onclick = () => {
        document.getElementById("editDescModal").style.display = "none";
      };

      document.getElementById("confirmEditDesc").onclick = async () => {
        const newDesc = document.getElementById("editDescInput").value.trim();
        const repo = window.EDIT_DESC_REPO;
        const path = window.EDIT_DESC_PATH || "";

        try {
          await ghFetch(`/repos/${USERNAME}/${repo}`, {
            method: "PATCH",
            body: JSON.stringify({ description: newDesc }),
          });
          document.getElementById("editDescModal").style.display = "none";
          toast("Popis aktualizov√°n!");
          await loadRepos();
          openRepo(repo, path);
        } catch (err) {
          toast("Chyba p≈ôi aktualizaci popisu: " + err.message, "error");
        }
      };

      // Close edit desc modal
      document
        .getElementById("editDescModal")
        .addEventListener("click", (e) => {
          if (e.target === document.getElementById("editDescModal")) {
            document.getElementById("editDescModal").style.display = "none";
          }
        });

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      //  FILE UPLOAD
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      function openFileUploadDialog(repo, path) {
        const input = document.createElement("input");
        input.type = "file";
        input.multiple = true;
        input.onchange = async (e) => {
          const files = Array.from(e.target.files);
          if (!files.length) return;

          toast(
            `Nahr√°v√°m ${files.length} soubor${files.length > 1 ? "≈Ø" : ""}...`,
          );

          let uploaded = 0;
          for (const file of files) {
            try {
              const content = await readFileAsBase64(file);
              const uploadPath = path ? `${path}/${file.name}` : file.name;

              await ghFetch(
                `/repos/${USERNAME}/${repo}/contents/${uploadPath}`,
                {
                  method: "PUT",
                  body: JSON.stringify({
                    message: `Upload: ${file.name}`,
                    content: content,
                  }),
                },
              );
              uploaded++;
            } catch (err) {
              toast(`Chyba p≈ôi nahr√°n√≠ ${file.name}: ${err.message}`, "error");
            }
          }

          if (uploaded > 0) {
            toast(
              `Nahr√°no ${uploaded} z ${files.length} soubor${uploaded > 1 ? "≈Ø" : ""}!`,
            );
            openRepo(repo, path);
          }
        };
        input.click();
      }

      function readFileAsBase64(file) {
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onload = () => {
            const base64 = reader.result.split(",")[1];
            resolve(base64);
          };
          reader.onerror = reject;
          reader.readAsDataURL(file);
        });
      }

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      //  DRAG & DROP FUNCTIONALITY
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      function setupDragAndDrop() {
        const overlay = document.getElementById("dragDropOverlay");
        const content = document.getElementById("mainContent");
        let dragCounter = 0;

        // Prevent default drag behaviors
        ["dragenter", "dragover", "dragleave", "drop"].forEach((eventName) => {
          document.body.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
          e.preventDefault();
          e.stopPropagation();
        }

        // Show overlay when dragging over
        document.body.addEventListener("dragenter", (e) => {
          // Only activate if user is logged in and viewing a repo
          if (!CURRENT_REPO) return;

          dragCounter++;
          overlay.classList.add("active");
          if (content) content.classList.add("drag-over");
        });

        document.body.addEventListener("dragleave", (e) => {
          dragCounter--;
          if (dragCounter === 0) {
            overlay.classList.remove("active");
            if (content) content.classList.remove("drag-over");
          }
        });

        // Handle drop
        document.body.addEventListener("drop", async (e) => {
          dragCounter = 0;
          overlay.classList.remove("active");
          if (content) content.classList.remove("drag-over");

          // Only process if user is logged in and viewing a repo
          if (!CURRENT_REPO) return;

          const items = e.dataTransfer.items;
          const files = [];

          // Process dropped items
          for (let i = 0; i < items.length; i++) {
            const item = items[i];
            if (item.kind === "file") {
              const entry = item.webkitGetAsEntry();
              if (entry) {
                await processEntry(entry, "", files);
              }
            }
          }

          if (files.length > 0) {
            await uploadFilesFromDrop(files);
          }
        });

        // Process directory entry recursively
        async function processEntry(entry, path, files) {
          if (entry.isFile) {
            return new Promise((resolve) => {
              entry.file((file) => {
                files.push({ file, path: path + file.name });
                resolve();
              });
            });
          } else if (entry.isDirectory) {
            const dirReader = entry.createReader();
            return new Promise((resolve) => {
              dirReader.readEntries(async (entries) => {
                for (const entry of entries) {
                  await processEntry(entry, path + entry.name + "/", files);
                }
                resolve();
              });
            });
          }
        }

        // Upload files from drop
        async function uploadFilesFromDrop(files) {
          toast(
            `Nahr√°v√°m ${files.length} soubor${files.length > 1 ? "≈Ø" : ""}...`,
          );
          let uploaded = 0;

          for (const { file, path: filePath } of files) {
            try {
              const content = await readFileAsBase64(file);
              const uploadPath = CURRENT_PATH
                ? `${CURRENT_PATH}/${filePath}`
                : filePath;

              await ghFetch(
                `/repos/${USERNAME}/${CURRENT_REPO}/contents/${uploadPath}`,
                {
                  method: "PUT",
                  body: JSON.stringify({
                    message: `Upload: ${filePath}`,
                    content: content,
                  }),
                },
              );
              uploaded++;
            } catch (err) {
              toast(`Chyba p≈ôi nahr√°n√≠ ${filePath}: ${err.message}`, "error");
            }
          }

          if (uploaded > 0) {
            toast(
              `Nahr√°no ${uploaded} z ${files.length} soubor${uploaded > 1 ? "≈Ø" : ""}!`,
            );
            openRepo(CURRENT_REPO, CURRENT_PATH);
          }
        }
      }

      // Initialize drag & drop after login
      setupDragAndDrop();

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      //  FILE FILTERING & SORTING
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      document
        .getElementById("fileFilterInput")
        .addEventListener("input", (e) => {
          CURRENT_FILTER = e.target.value.trim();
          if (CURRENT_REPO && ALL_FILES.length > 0) {
            // Re-render bez nov√©ho API callu
            const repoInfo = REPOS.find((r) => r.name === CURRENT_REPO);
            if (repoInfo) {
              renderFileList(repoInfo, CURRENT_REPO, CURRENT_PATH);
            }
          }
        });

      document
        .getElementById("fileSortSelect")
        .addEventListener("change", (e) => {
          CURRENT_SORT = e.target.value;
          if (CURRENT_REPO && ALL_FILES.length > 0) {
            const repoInfo = REPOS.find((r) => r.name === CURRENT_REPO);
            if (repoInfo) {
              renderFileList(repoInfo, CURRENT_REPO, CURRENT_PATH);
            }
          }
        });

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      //  KEYBOARD SHORTCUTS
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      document.addEventListener("keydown", (e) => {
        // Ctrl+F - Fokus na filtrov√°n√≠
        if (e.ctrlKey && e.key === "f" && CURRENT_REPO) {
          e.preventDefault();
          document.getElementById("fileFilterInput").focus();
        }

        // Delete - Smazat vybran√© soubory (v contextu repozit√°≈ôe)
        if (e.key === "Delete" && CURRENT_REPO) {
          const selectedRows = document.querySelectorAll(
            ".row-checkbox:checked",
          );
          if (selectedRows.length > 0) {
            e.preventDefault();
            if (confirm(`Smazat ${selectedRows.length} vybran√Ωch polo≈æek?`)) {
              selectedRows.forEach(async (checkbox) => {
                const row = checkbox.closest(".file-row");
                if (row) {
                  const name = row.dataset.name;
                  const path = row.dataset.path;
                  const type = row.dataset.type;
                  try {
                    if (type === "dir") {
                      await deleteDir(CURRENT_REPO, path);
                    } else {
                      const fileData = await ghFetch(
                        `/repos/${USERNAME}/${CURRENT_REPO}/contents/${path}`,
                      );
                      await ghFetch(
                        `/repos/${USERNAME}/${CURRENT_REPO}/contents/${path}`,
                        {
                          method: "DELETE",
                          body: JSON.stringify({
                            message: `Delete: ${name}`,
                            sha: fileData.sha,
                          }),
                        },
                      );
                    }
                  } catch (err) {
                    toast(`Chyba p≈ôi maz√°n√≠ ${name}: ${err.message}`, "error");
                  }
                }
              });
              setTimeout(() => openRepo(CURRENT_REPO, CURRENT_PATH), 1000);
            }
          }
        }

        // F2 - P≈ôejmenovat prvn√≠ vybran√Ω soubor
        if (e.key === "F2" && CURRENT_REPO) {
          e.preventDefault();
          const selectedRow = document.querySelector(".row-checkbox:checked");
          if (selectedRow) {
            const row = selectedRow.closest(".file-row");
            if (row) {
              const name = row.dataset.name;
              const path = row.dataset.path;
              const type = row.dataset.type;
              openFileContext(
                name,
                path,
                type,
                row.dataset.size || 0,
                CURRENT_REPO,
              );
              // Automaticky otev≈ô√≠t rename
              setTimeout(() => {
                const renameBtn = document.getElementById("ctxRename");
                if (renameBtn) renameBtn.click();
              }, 100);
            }
          }
        }

        // Escape - Zav≈ô√≠t modaly
        if (e.key === "Escape") {
          document.getElementById("fileViewerModal").style.display = "none";
          document.getElementById("ctxModal").style.display = "none";
          document.getElementById("newFileModal").style.display = "none";
          document.getElementById("newRepoModal").style.display = "none";
          document.getElementById("repoCtxModal").style.display = "none";
          document.getElementById("editDescModal").style.display = "none";
        }
      });

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      //  AUTO LOGIN (page load)
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      (async () => {
        const saved = loadToken();
        if (!saved) return;
        TOKEN = saved;
        try {
          const user = await ghFetch("/user");
          USERNAME = user.login;
          await loadRepos();
          document.getElementById("loginPanel").style.display = "none";
          document.getElementById("sidebar").style.display = "flex";
          document.getElementById("mainContent").style.display = "block";
          document.getElementById("statusDot").classList.add("connected");
          document.getElementById("statusLabel").textContent =
            "P≈ôihl√°≈°en jako " + USERNAME;
          document.getElementById("logoutBtn").style.display = "inline-block";
          document.getElementById("logoutArea").style.display = "block";
          showHomeView();
        } catch (e) {
          clearToken();
          TOKEN = "";
        }
      })();
    </script>
  </body>
</html>
