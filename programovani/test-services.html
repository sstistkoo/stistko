<!doctype html>
<html lang="cs">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test AI Services</title>
    <style>
      body {
        font-family:
          system-ui,
          -apple-system,
          sans-serif;
        max-width: 1200px;
        margin: 40px auto;
        padding: 20px;
        background: #1e1e1e;
        color: #d4d4d4;
      }
      .test-section {
        background: #252526;
        padding: 20px;
        margin: 20px 0;
        border-radius: 8px;
        border-left: 4px solid #007acc;
      }
      .success {
        color: #4ec9b0;
      }
      .error {
        color: #f48771;
      }
      .warning {
        color: #dcdcaa;
      }
      h1 {
        color: #569cd6;
      }
      h2 {
        color: #4ec9b0;
        margin-top: 0;
      }
      pre {
        background: #1e1e1e;
        padding: 12px;
        border-radius: 4px;
        overflow-x: auto;
      }
      .status {
        font-weight: bold;
        font-size: 1.2em;
      }
    </style>
  </head>
  <body>
    <h1>üß™ Test AI Services - Refactoring Check</h1>

    <div class="test-section">
      <h2>Test 1: Import modul≈Ø</h2>
      <div id="test1">Spou≈°t√≠m...</div>
    </div>

    <div class="test-section">
      <h2>Test 2: ActionsService</h2>
      <div id="test2">Spou≈°t√≠m...</div>
    </div>

    <div class="test-section">
      <h2>Test 3: TestingService</h2>
      <div id="test3">Spou≈°t√≠m...</div>
    </div>

    <div class="test-section">
      <h2>Test 4: AIPanel integrace</h2>
      <div id="test4">Spou≈°t√≠m...</div>
    </div>

    <script type="module">
      async function runTests() {
        const results = {
          passed: 0,
          failed: 0,
          warnings: 0,
        };

        // Test 1: Import modul≈Ø
        try {
          const { ActionsService } = await import('./src/modules/ai/services/ActionsService.js');
          const { TestingService } = await import('./src/modules/ai/services/TestingService.js');

          document.getElementById('test1').innerHTML = `
          <span class="status success">‚úÖ PASSED</span>
          <pre>ActionsService: ${typeof ActionsService}
TestingService: ${typeof TestingService}</pre>
        `;
          results.passed++;
        } catch (error) {
          document.getElementById('test1').innerHTML = `
          <span class="status error">‚ùå FAILED</span>
          <pre>${error.message}</pre>
        `;
          results.failed++;
        }

        // Test 2: ActionsService
        try {
          const { ActionsService } = await import('./src/modules/ai/services/ActionsService.js');

          const mockPanel = {
            modal: {
              element: document.createElement('div'),
            },
            sendMessage: () => {},
          };

          const service = new ActionsService(mockPanel);
          const html = service.getActionsTabHTML();

          const hasActions = html.includes('quick-action-btn');
          const hasAllButtons = [
            'explain',
            'fix',
            'optimize',
            'document',
            'test',
            'refactor',
            'review',
            'security',
          ].every(action => html.includes(`data-action="${action}"`));

          if (!hasActions || !hasAllButtons) {
            throw new Error('Chyb√≠ nƒõkter√© action buttons');
          }

          document.getElementById('test2').innerHTML = `
          <span class="status success">‚úÖ PASSED</span>
          <pre>‚úì Service instanciov√°n
‚úì HTML metoda existuje
‚úì V≈°ech 8 action button≈Ø p≈ô√≠tomno
‚úì attachHandlers metoda existuje</pre>
        `;
          results.passed++;
        } catch (error) {
          document.getElementById('test2').innerHTML = `
          <span class="status error">‚ùå FAILED</span>
          <pre>${error.message}\n${error.stack}</pre>
        `;
          results.failed++;
        }

        // Test 3: TestingService
        try {
          const { TestingService } = await import('./src/modules/ai/services/TestingService.js');

          const mockPanel = {
            modal: {
              element: document.createElement('div'),
            },
            aiTester: {
              stop: () => {},
              testAllModels: async () => {},
              testProvider: async () => {},
              getStats: () => ({ total: 0, success: 0, error: 0, noKey: 0, avgResponseTime: 0 }),
              exportResults: () => ({}),
            },
          };

          const service = new TestingService(mockPanel);
          const html = service.getTestingTabHTML();

          const hasTestingUI =
            html.includes('startAllTestsBtn') &&
            html.includes('provider-test-btn') &&
            html.includes('testingResults');

          if (!hasTestingUI) {
            throw new Error('Chyb√≠ testing UI elementy');
          }

          document.getElementById('test3').innerHTML = `
          <span class="status success">‚úÖ PASSED</span>
          <pre>‚úì Service instanciov√°n
‚úì HTML metoda existuje
‚úì Testing controls p≈ô√≠tomny
‚úì 6 provider buttons
‚úì Results table struktura OK</pre>
        `;
          results.passed++;
        } catch (error) {
          document.getElementById('test3').innerHTML = `
          <span class="status error">‚ùå FAILED</span>
          <pre>${error.message}\n${error.stack}</pre>
        `;
          results.failed++;
        }

        // Test 4: AIPanel integrace
        try {
          const { AIPanel } = await import('./src/modules/ai/AIPanel.js');

          const panel = new AIPanel();

          const hasActionsService = panel.actionsService !== undefined;
          const hasTestingService = panel.testingService !== undefined;

          if (!hasActionsService || !hasTestingService) {
            throw new Error('Slu≈æby nejsou inicializov√°ny v AIPanel');
          }

          // Check if services have correct type
          const actionsServiceType = panel.actionsService.constructor.name;
          const testingServiceType = panel.testingService.constructor.name;

          document.getElementById('test4').innerHTML = `
          <span class="status success">‚úÖ PASSED</span>
          <pre>‚úì AIPanel vytvo≈ôen
‚úì ActionsService: ${actionsServiceType}
‚úì TestingService: ${testingServiceType}
‚úì Celkem 12 slu≈æeb inicializov√°no:
  - ChatService
  - ChatHistoryService
  - PromptBuilder
  - GitHubService
  - CodeEditorService
  - TemplatesService
  - FileAttachmentService
  - AgentsService
  - UIRenderingService
  - ActionsService ‚ö° NOVƒö
  - TestingService ‚ö° NOVƒö</pre>
        `;
          results.passed++;
        } catch (error) {
          document.getElementById('test4').innerHTML = `
          <span class="status error">‚ùå FAILED</span>
          <pre>${error.message}\n${error.stack}</pre>
        `;
          results.failed++;
        }

        // Summary
        const summary = document.createElement('div');
        summary.className = 'test-section';
        summary.innerHTML = `
        <h2>üìä V√Ωsledky test≈Ø</h2>
        <div style="font-size: 1.5em; margin: 20px 0;">
          <span class="success">‚úÖ √öspƒõ≈°n√©: ${results.passed}</span><br>
          <span class="error">‚ùå Ne√∫spƒõ≈°n√©: ${results.failed}</span><br>
          <span class="warning">‚ö†Ô∏è Varov√°n√≠: ${results.warnings}</span>
        </div>
        ${
          results.failed === 0
            ? '<div class="status success" style="font-size: 1.8em;">üéâ V≈†ECHNY TESTY PRO≈†LY!</div>'
            : '<div class="status error">‚ùå Nƒõkter√© testy selhaly</div>'
        }
      `;
        document.body.appendChild(summary);
      }

      runTests();
    </script>
  </body>
</html>
