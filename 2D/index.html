<!DOCTYPE html>
<html lang="cs">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="theme-color" content="#0a0a0a" />
    <title>Soustru≈æn√≠k - Parametrick√© kreslen√≠ + AI</title>

    <!--
    ‚úÖ DEMO API KL√çƒåE JSOU P≈òEDVYPLNƒöN√â!
    Aplikace funguje okam≈æitƒõ po otev≈ôen√≠ - m√°te Gemini, Groq, OpenRouter i Mistral!

    Kl√≠ƒçe jsou rozdƒõlen√© na 2 ƒç√°sti (v globals.js):
    - Gemini: EMBEDDED_API_KEY = ƒç√°st1 + ƒç√°st2
    - Groq: EMBEDDED_GROQ_API_KEY = ƒç√°st1 + ƒç√°st2
    - OpenRouter: EMBEDDED_OPENROUTER_API_KEY = ƒç√°st1 + ƒç√°st2
    - Mistral: EMBEDDED_MISTRAL_API_KEY = ƒç√°st1 + ƒç√°st2

    Pro vlastn√≠ kl√≠ƒçe:
    - Kliknƒõte na ‚ú® AI ‚Üí ‚öôÔ∏è Settings
    - Gemini tab: https://aistudio.google.com/app/apikey
    - Groq tab: https://console.groq.com/keys
    - OpenRouter tab: https://openrouter.ai/keys
    - Mistral tab: https://console.mistral.ai/api-keys/
    -->

    <link rel="stylesheet" href="styles.css" />
    <script type="importmap">
      {
        "imports": {
          "@google/genai": "https://esm.sh/@google/genai@^1.33.0"
        }
      }
    </script>
    <!-- GLOBALS + KEYBOARD MUS√ç B√ùT PRVN√ç! -->
    <script src="src/globals.js"></script>
    <script src="src/keyboard.js"></script>
    <script>console.log("‚úÖ index.html loaded");</script>
    <script src="src/utils.js"></script>
    <script src="src/drawing.js"></script>
    <script src="src/canvas.js?v=4"></script>
    <script src="src/ui.js"></script>
    <script src="src/polar-line.js"></script>
    <script src="src/controller.js"></script>
    <script src="src/ai.js"></script>
    <script src="lib/init.js"></script>
  </head>
  <body>
    <div class="canvas-area">
      <!-- Ovl√°d√°n√≠ pl√°tna vpravo naho≈ôe -->
      <div class="canvas-controls">
        <button
          class="canvas-btn"
          onclick="window.togglePan()"
          id="btnPanCanvas"
          title="Posun (Klikni pro zapnut√≠/vypnut√≠)"
        >
          <span>‚úã</span>
          <div>Posun</div>
        </button>
        <button
          class="canvas-btn"
          onclick="window.resetView()"
          title="Zobrazit v≈°echny objekty (Fit All)"
        >
          <span>‚åñ</span>
          <div>Fit All</div>
        </button>
        <button
          class="canvas-btn"
          onclick="window.undo()"
          id="btnUndo"
          title="Zpƒõt - vr√°tit posledn√≠ akci (Ctrl+Z)"
        >
          <span>‚Ü∂</span>
          <div>Zpƒõt</div>
        </button>
        <button
          class="canvas-btn"
          onclick="window.redo()"
          id="btnRedo"
          title="Vp≈ôed - obnovit vr√°cenou akci (Ctrl+Y)"
        >
          <span>‚Ü∑</span>
          <div>Vp≈ôed</div>
        </button>
        <button
          class="canvas-btn"
          onclick="window.toggleAiSelect()"
          id="btnSelectCanvas"
          title="P≈ôepnout re≈æim v√Ωbƒõru"
        >
          <span>üëÜ</span>
          <div>V√Ωbƒõr</div>
        </button>
      </div>

      <!-- AI PANEL -->
      <div
        class="tool-submenu ai-overlay"
        id="toolsAi"
        style="display: none;"
      >
        <div
          id="aiPanel"
          class="ai-panel"
        >
          <!-- AI Header s nastaven√≠m -->
          <div
            id="aiHeaderRow"
            class="ai-header-row"
          >
            <div id="aiHeaderFirstRow" class="ai-header-first-row">
              <!-- Lev√° ƒç√°st: Provider + Model + AI Type + Settings -->
              <div class="ai-header-left">
                <!-- Provider + Model + AI Type (vertik√°lnƒõ) -->
                <div class="ai-header-selects">
                  <!-- AI Provider (Gemini / Groq / OpenRouter / Mistral) -->
                  <select
                    id="aiProviderSelect"
                    onchange="if(window.updateModelsForProvider) window.updateModelsForProvider()"
                    class="ai-select"
                    title="Vyberte AI poskytovatele"
                  >
                    <option value="gemini" selected>ü§ñ Gemini</option>
                    <option value="groq">‚ö° Groq</option>
                    <option value="openrouter">üåê OpenRouter</option>
                    <option value="mistral">üî• Mistral</option>
                  </select>

                  <!-- AI Model -->
                  <select
                    id="aiModelSelect"
                    class="ai-select"
                  >
                    <option value="gemini-2.5-flash-lite" selected>
                      ‚ö° Gemini 2.5 Flash-Lite (Vy≈°≈°√≠ limit)
                    </option>
                    <option value="gemini-2.5-flash">
                      ‚ö° Gemini 2.5 Flash (Rychl√Ω)
                    </option>
                    <option value="gemini-3-pro-preview">
                      üß™ Gemini 3 Pro (Nejchyt≈ôej≈°√≠)
                    </option>
                    <option value="gemini-2.0-flash-exp">
                      ‚ö° Gemini 2.0 Flash (Exp)
                    </option>
                  </select>

                  <!-- AI Type (2D / CNC / Chat) -->
                  <select
                    id="aiTypeSelect"
                    class="ai-select"
                    title="Vyberte re≈æim AI: 2D = kreslen√≠, CNC = generov√°n√≠ G-k√≥du/tvar≈Ø, Chat = bƒõ≈æn√Ω chat"
                  >
                    <option value="2d" selected>‚úèÔ∏è 2D (kreslen√≠)</option>
                    <option value="cnc">üõ†Ô∏è CNC (k√≥dov√°n√≠)</option>
                    <option value="chat">üí¨ Chat (pokec)</option>
                  </select>
                </div>

                <!-- Settings Button -->
                <button
                  onclick="window.openSettings()"
                  title="Nastaven√≠ API kl√≠ƒçe"
                  class="ai-header-btn ai-settings-btn ai-btn-transparent"
                >
                  <span class="ai-btn-icon">‚öôÔ∏è</span>
                </button>
              </div>

              <!-- Prav√° ƒç√°st: Tlaƒç√≠tka ve sloupc√≠ch -->
              <div class="ai-header-right">
                <!-- Horn√≠ ≈ô√°dek: Minimize a Close -->
                <div class="ai-header-top-buttons">
                  <!-- Minimize Button -->
                  <button
                    onclick="window.minimizeAI()"
                    title="Minimalizovat AI (pokraƒçuje v pr√°ci)"
                    class="ai-header-btn ai-action-btn ai-btn-action ai-btn-minimize"
                  >
                    <span>‚àí</span>
                  </button>

                  <!-- Close Button -->
                  <button
                    onclick="window.closeAI()"
                    title="Zav≈ô√≠t AI a ukonƒçit ƒçinnost"
                    class="ai-header-btn ai-action-btn ai-btn-action ai-btn-close"
                  >
                    <span>√ó</span>
                  </button>
                </div>

                <!-- Doln√≠ ≈ô√°dek: Memory, Preferences, Metrics -->
                <div class="ai-header-bottom-buttons">
                  <!-- AI Memory Button -->
                  <button
                    onclick="showAIMemory()"
                    title="AI Pamƒõ≈• - Co se AI nauƒçila"
                    class="ai-header-btn ai-btn-transparent"
                  >
                    <span class="ai-btn-icon-sm">üß†</span>
                  </button>

                  <!-- AI Preferences Button -->
                  <button
                    onclick="openAIPreferences()"
                    title="Nastavit preference AI (uƒç√≠ se)"
                    class="ai-header-btn ai-btn-transparent"
                  >
                    <span class="ai-btn-icon-sm">üéì</span>
                  </button>

                  <!-- Debug Metrics Button -->
                  <button
                    onclick="showAIMetrics()"
                    title="Zobrazit AI statistiky"
                    class="ai-header-btn ai-btn-transparent"
                  >
                    <span class="ai-btn-icon-sm">üìä</span>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Chat hist√≥ria -->
          <div id="aiChatHistory" class="chat-container">
            <div class="ai-chat-placeholder">
              Zaƒç√°tek konverzace. Zeptejte se na cokoliv nebo popi≈°te tvar.
            </div>

            <!-- Info o povolen√≠ -->
            <div
              id="permissionInfo"
              class="ai-permission-info"
            >
              <div class="ai-permission-title">
                ‚ÑπÔ∏è Pro plnou funkƒçnost na mobilu:
              </div>
              <div class="ai-permission-item">
                üì∑ <strong>Kamera</strong> - pro focen√≠ n√°ƒçrt≈Ø
              </div>
              <div class="ai-permission-item">üé§ <strong>Mikrofon</strong> - pro hlasov√© zad√°v√°n√≠</div>
              <div class="ai-permission-note">
                Povolen√≠ se vy≈æ√°daj√≠ p≈ôi prvn√≠m pou≈æit√≠.
              </div>
              <button
                onclick="document.getElementById('permissionInfo').style.display='none'"
                class="ai-permission-btn"
              >
                Rozum√≠m
              </button>
            </div>
          </div>

          <!-- Selection & Tools Toolbar -->
          <div class="ai-toolbar">
            <button
              id="btnAiSelect"
              onclick="window.toggleAiSelect(); document.getElementById('toolsAi').style.display='none'; document.getElementById('btnCatAi').classList.remove('active')"
              class="ai-toolbar-btn ai-toolbar-btn-select"
              title="P≈ôepnout re≈æim v√Ωbƒõru"
            >
              <span class="ai-toolbar-btn-icon-sm">üëÜ</span> V√Ωbƒõr
            </button>

            <button
              onclick="window.openQuickInput()"
              class="ai-toolbar-btn ai-toolbar-btn-keyboard"
              title="Rychl√© zad√°n√≠ (Kl√°vesnice)"
            >
              <span class="ai-toolbar-btn-icon-md">‚å®Ô∏è</span> Kl√°vesnice
            </button>

            <button
              onclick="window.aiUndo()"
              class="ai-toolbar-btn ai-toolbar-btn-icon"
              title="Zpƒõt (Undo)"
            >
              ‚Ü∂
            </button>

            <button
              onclick="window.aiRedo()"
              class="ai-toolbar-btn ai-toolbar-btn-icon"
              title="Vp≈ôed (Redo)"
            >
              ‚Ü∑
            </button>

            <!-- Camera Button -->
            <button
              onclick="document.getElementById('aiImageInput').click()"
              title="Nahr√°t obr√°zek / Vyfotit"
              class="ai-toolbar-btn ai-toolbar-btn-icon"
            >
              üì∑
            </button>
            <input
              type="file"
              id="aiImageInput"
              accept="image/*"
              capture="environment"
              class="hidden-input"
              onchange="window.handleImageSelect(this)"
            />

            <!-- Voice Button -->
            <button
              onclick="window.toggleVoice()"
              id="btnVoice"
              title="Hlasov√© zad√°n√≠"
              class="ai-toolbar-btn ai-toolbar-btn-icon"
            >
              üé§
            </button>

            <button
              onclick="window.clearSelection()"
              id="btnClearSelection"
              class="ai-toolbar-btn ai-toolbar-btn-clear"
              title="Zru≈°it v√Ωbƒõr"
            >
              ‚úï
            </button>
          </div>

          <!-- Selection List -->
          <div
            id="aiSelectionList"
            class="selection-list"
            class="d-none"
          ></div>

          <!-- Chat Window -->
          <div id="chatWindow" class="ai-chat-window"></div>

          <!-- Input z√≥na -->
          <div id="aiInputZone" class="ai-input-zone">
            <!-- Deep Think Checkbox + Image Upload -->
            <div class="ai-input-options">
              <label class="ai-deep-think-label">
                <input
                  type="checkbox"
                  id="useThinking"
                  class="ai-deep-think-checkbox"
                />
                <span>üß† Deep Think
                  <span class="ai-opacity-light">(Gemini 3 Pro)</span></span>
              </label>

              <!-- Image Upload Container (zobraz√≠ se jen pro Groq Vision modely) -->
              <div id="imageUploadContainer" class="ai-image-upload-container">
                <label class="ai-image-upload-label">
                  <span>üì∑ Obr√°zek</span>
                  <input
                    type="file"
                    accept="image/*"
                    onchange="if(window.handleImageSelect) window.handleImageSelect(this)"
                    class="hidden-input"
                  />
                </label>
              </div>

              <span id="aiFileName" class="ai-file-name"></span>
            </div>

            <!-- Image Preview -->
            <div id="aiImagePreview" class="ai-image-preview">
              <img id="aiPreviewImg" class="ai-preview-img" />
              <button onclick="window.clearImage()" class="ai-preview-close-btn">
                ‚úï
              </button>
            </div>

            <div class="ai-input-row">
              <div class="ai-input-wrapper">
                <textarea
                  id="aiPrompt"
                  rows="1"
                  placeholder="Zpr√°va pro Gemini..."
                  onkeydown="if(event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); if(window.callGemini) { window.callGemini(); } }"
                  class="ai-prompt-textarea"
                ></textarea>
                <div id="cncInputError" class="ai-input-error"></div>
              </div>

              <button
                onclick="if(!window.processingAI && window.callGemini) { window.callGemini(); } else { alert('AI u≈æ zpracov√°v√° request nebo test bƒõ≈æ√≠!'); }"
                id="btnGenerate"
                class="ai-btn-send"
                title="Odeslat do AI"
              >
                ‚û§
              </button>

              <button
                onclick="if(window.cancelAIRequest) { window.cancelAIRequest(); }"
                id="btnCancel"
                class="ai-btn-cancel"
                title="Zru≈°it po≈æadavek"
              >
                ‚äó
              </button>

              <!-- Test Button -->
              <button
                onclick="if(window.showAITestPanel) window.showAITestPanel()"
                class="ai-btn-test"
                title="Spustit AI test suite"
              >
                üß™
              </button>
            </div>

            <div id="aiStatus" class="ai-status">
              <span id="keyIndicator" style="display: none;">API Kl√≠ƒç: ≈Ω√°dn√Ω</span>
            </div>

            <!-- API Usage Stats -->
            <div id="apiUsageInfo" class="ai-usage-info"></div>
          </div>
        </div>
      </div>

      <!-- Kreslen√≠ panel -->
      <div class="tool-submenu d-none" id="toolsDrawing" style="display: none;">
        <div class="drawing-panel drawing-panel-wrapper">
        <!-- Header: polar snap angle + grip -->
        <div class="tool-header drawing-panel-header">
          <div class="drawing-panel-header-left">
            <label class="drawing-panel-label">Pol√°rn√≠ krok ƒç√°ra (¬∞):
              <input type="number" id="polarLineAngle" min="0" max="360" value="" placeholder="vypnuto" oninput="window.updatePolarLineAngle(this.value)" class="drawing-panel-input">
            </label>
          </div>
          <div class="drawing-panel-header-right">
            <div class="panel-grip drawing-panel-grip">‚â°</div>
          </div>
        </div>
        <div class="tools-content">
          <div class="drawing-tools-grid">
            <!-- Z√°kladn√≠ n√°stroje -->
            <button
              class="tool-btn tool-btn-drawing"
              onclick="window.setMode('line')"
              id="btnLine"
              title="Nakreslit ƒç√°ru"
            >
              <span class="tool-btn-icon">üìè</span>
              <div class="tool-btn-label">ƒå√°ra</div>
            </button>

            <!-- Kru≈ænice - rozbalovac√≠ menu -->
            <div class="dropdown-container">
              <button
                class="tool-btn tool-btn-drawing"
                id="btnCircle"
                onclick="document.getElementById('circleMenu').style.display = document.getElementById('circleMenu').style.display === 'none' ? 'flex' : 'none'"
                title="Nakreslit kru≈ænici"
              >
                <span class="tool-btn-icon">‚≠ï</span>
                <div class="tool-btn-label">Kru≈ænice ‚ñº</div>
              </button>
              <div
                id="circleMenu"
                class="dropdown-menu"
                style="display: none;"
                  border-radius: 6px;
                  display: none;
                  flex-direction: column;
                  gap: 4px;
                  padding: 6px;
                  min-width: 140px;
                  z-index: 1000;
                "
              >
                <button
                  class="tool-btn"
                  onclick="window.setMode('circle'); document.getElementById('circleMenu').style.display='none'"
                  style="
                    width: 100%;
                    margin: 0;
                    background: #333;
                    border: 1px solid #444;
                    padding: 8px;
                    border-radius: 4px;
                    color: #ccc;
                    font-size: 11px;
                    cursor: pointer;
                    text-align: left;
                  "
                  title="Bƒõ≈æn√° kru≈ænice (st≈ôed ‚Üí obvod)"
                >
                  üìç‚Üí‚≠ï Norm√°ln√≠
                </button>
                <button
                  class="tool-btn"
                  onclick="window.setMode('circumcircle'); document.getElementById('circleMenu').style.display='none'"
                  style="
                    width: 100%;
                    margin: 0;
                    background: #333;
                    border: 1px solid #444;
                    padding: 8px;
                    border-radius: 4px;
                    color: #ccc;
                    font-size: 11px;
                    cursor: pointer;
                    text-align: left;
                  "
                  title="Kru≈ænice proch√°zej√≠c√≠ 3 body"
                >
                  3Ô∏è‚É£ Skrze 3 body
                </button>
              </div>
            </div>

            <button class="tool-btn no-margin" onclick="window.setMode('arc')" id="btnArc" title="Nakreslit oblouk">
              <span class="tool-btn-icon">üåô</span>
              <div class="tool-btn-label">Oblouk</div>
            </button>
            <button class="tool-btn no-margin" onclick="window.setMode('point')" id="btnPoint" title="Vytvo≈ôit bod">
              <span class="tool-btn-icon">üìç</span>
              <div class="tool-btn-label">Bod</div>
            </button>
            <button class="tool-btn no-margin" onclick="window.setMode('rectangle')" id="btnRectangle" title="Nakreslit obd√©ln√≠k">
              <span class="tool-btn-icon">‚ñ≠</span>
              <div class="tool-btn-label">Obd√©ln√≠k</div>
            </button>

            <!-- Konstrukce -->
            <button class="tool-btn no-margin" onclick="window.setMode('tangent')" id="btnTangent" title="Teƒçna ke kru≈ænici">
              <span class="tool-btn-icon">‚üÇ</span>
              <div class="tool-btn-label">Teƒçna</div>
            </button>
            <button class="tool-btn no-margin" onclick="window.setMode('perpendicular')" id="btnPerpendicular" title="Kolmice">
              <span class="tool-btn-icon">‚î¥</span>
              <div class="tool-btn-label">Kolmice</div>
            </button>
            <button class="tool-btn no-margin" onclick="window.setMode('parallel')" id="btnParallel" title="Rovnobƒõ≈æka">
              <span class="tool-btn-icon">‚à•</span>
              <div class="tool-btn-label">Rovnobƒõ≈æka</div>
            </button>
          </div>
          <div class="section-divider">
            <label class="checkbox-label">
              <input type="checkbox" id="polarSnapCheckboxLegacy" onchange="window.togglePolarSnapLegacy()" checked />
              Pol√°rn√≠ p≈ôichycen√≠ (15¬∞, 30¬∞, 45¬∞...)
            </label>
            <label class="checkbox-label mt-8">
              Pol√°rn√≠ krok (¬∞):
              <input type="number" id="polarSnapStep" min="1" max="90" value="45" class="polar-step-input">
            </label>
          </div>
        </div>
        </div>
      </div>

      <!-- √öpravy panel -->
      <div class="tool-submenu d-none" id="toolsEdit" style="display: none;">
        <div class="tool-submenu-panel max-w-500">
          <div class="flex-wrap-center">
            <!-- Editace -->
            <button class="tool-btn no-margin" onclick="window.setMode('trim')" id="btnTrim" title="O≈ôezat ƒç√°ru">
              <span class="tool-btn-icon">‚úÇÔ∏è</span>
              <div class="tool-btn-label">O≈ô√≠znut√≠</div>
            </button>
            <button class="tool-btn no-margin" onclick="window.setMode('extend')" id="btnExtend" title="Prot√°hnout ƒç√°ru">
              <span class="tool-btn-icon">‚ÜîÔ∏è</span>
              <div class="tool-btn-label">Prota≈æen√≠</div>
            </button>
            <button class="tool-btn no-margin" onclick="window.setMode('offset')" id="btnOffset" title="Odsadit objekt">
              <span class="tool-btn-icon">‚áÑ</span>
              <div class="tool-btn-label">Odsazen√≠</div>
            </button>
            <button class="tool-btn no-margin" onclick="window.setMode('mirror')" id="btnMirror" title="Zrcadlit objekt">
              <span class="tool-btn-icon">ü™û</span>
              <div class="tool-btn-label">Zrcadlit</div>
            </button>
            <button class="tool-btn no-margin" onclick="window.setMode('erase')" id="btnErase" title="Smazat objekt">
              <span class="tool-btn-icon">üóëÔ∏è</span>
              <div class="tool-btn-label">Guma</div>
            </button>
            <button class="tool-btn no-margin" onclick="calculateIntersections()" id="btnIntersect" title="Spoƒç√≠tat pr≈Øseƒç√≠ky">
              <span class="tool-btn-icon">‚äó</span>
              <div class="tool-btn-label">Pr≈Øseƒç√≠ky</div>
            </button>
            <button class="tool-btn no-margin" onclick="window.setMode('measure')" id="btnMeasure" title="Zmƒõ≈ôit rozmƒõry">
              <span class="tool-btn-icon">üìè</span>
              <div class="tool-btn-label">Mƒõ≈ôen√≠</div>
            </button>
            <button class="tool-btn no-margin" onclick="window.showConstraintModal()" id="btnConstraint" title="Fixace - aretov√°n√≠">
              <span class="tool-btn-icon">üîí</span>
              <div class="tool-btn-label">Fixace</div>
            </button>
            <button class="tool-btn no-margin" onclick="window.setMode('dimension')" id="btnDimension" title="K√≥tovat objekt">
              <span class="tool-btn-icon">üìê</span>
              <div class="tool-btn-label">K√≥ta</div>
            </button>
            <button class="tool-btn no-margin" onclick="window.deleteAllDimensions()" id="btnDeleteDimensions" title="Smazat v≈°echny k√≥ty">
              <span class="tool-btn-icon">‚ùå</span>
              <div class="tool-btn-label">Smazat k√≥ty</div>
            </button>
            <button class="tool-btn no-margin" onclick="window.dimensionAll()" id="btnDimensionAll" title="Okotovat v≈°echny ƒç√°ry a kru≈ænice">
              <span class="tool-btn-icon">üìè‚ú®</span>
              <div class="tool-btn-label">Okotovat v≈°e</div>
            </button>

            <!-- Transformace -->
            <button class="tool-btn no-margin" onclick="window.setMode('align')" title="Zarovnat a posunout">
              <span class="tool-btn-icon">‚öñÔ∏è</span>
              <div class="tool-btn-label">Zarovn√°n√≠</div>
            </button>
            <button class="tool-btn no-margin" onclick="window.setMode('rotate')" title="Otoƒçit objekty">
              <span class="tool-btn-icon">üîÅ</span>
              <div class="tool-btn-label">Rotace</div>
            </button>
            <button class="tool-btn no-margin" onclick="window.showColorPicker()" title="Zmƒõnit barvu a typ ƒç√°ry">
              <span class="tool-btn-icon">üé®</span>
              <div class="tool-btn-label">Barva, typ</div>
            </button>

            <!-- Booleovsk√© operace -->
            <button class="tool-btn no-margin" onclick="window.booleanUnion()" title="Sjednocen√≠">
              <span class="tool-btn-icon">‚à™</span>
              <div class="tool-btn-label">Sjednocen√≠</div>
            </button>
            <button class="tool-btn no-margin" onclick="window.booleanIntersect()" title="Pr≈Ønik">
              <span class="tool-btn-icon">‚à©</span>
              <div class="tool-btn-label">Pr≈Ønik</div>
            </button>
            <button class="tool-btn no-margin" onclick="window.booleanDifference()" title="Rozd√≠l">
              <span class="tool-btn-icon">‚àí</span>
              <div class="tool-btn-label">Rozd√≠l</div>
            </button>
          </div>
        </div>
      </div>

      <!-- Sou≈ôadnice panel -->
      <div class="tool-submenu coords-panel d-none" id="toolsCoords" style="display: none;">
        <div class="tool-submenu-panel max-w-400">
          <!-- Bod -->
          <div class="section-wrapper">
            <div class="section-header" onclick="window.toggleCoordSection('coordBod')">
              <strong class="section-title">üìç Bod</strong>
              <span id="coordBodToggle" class="section-toggle">‚ñº</span>
            </div>
            <div id="coordBod" class="section-content">
              <div class="flex-gap-8 mb-8">
                <input type="number" id="quickPointZ" placeholder="Z" step="0.01" class="coord-input" />
                <input type="number" id="quickPointX" placeholder="X" step="0.01" class="coord-input" />
              </div>
              <div class="flex-gap-8">
                <button class="btn-secondary" onclick="window.setPointFromCursor()">üìç Z kurzoru</button>
                <button class="btn-primary" onclick="window.quickAddPoint()">+ P≈ôidat</button>
              </div>
            </div>
          </div>

          <!-- ƒå√°ra -->
          <div class="section-wrapper">
            <div class="section-header" onclick="window.toggleCoordSection('coordLine')">
              <strong class="section-title">üìè ƒå√°ra</strong>
              <span id="coordLineToggle" class="section-toggle">‚ñº</span>
            </div>
            <div id="coordLine" class="section-content">
              <div class="input-label">Bod 1:</div>
              <div class="flex-gap-8 mb-8">
                <input type="number" id="lineZ1" placeholder="Z1" step="0.01" class="coord-input-sm" />
                <input type="number" id="lineX1" placeholder="X1" step="0.01" class="coord-input-sm" />
              </div>
              <div class="input-label">Bod 2:</div>
              <div class="flex-gap-8 mb-8">
                <input type="number" id="lineZ2" placeholder="Z2" step="0.01" class="coord-input-sm" />
                <input type="number" id="lineX2" placeholder="X2" step="0.01" class="coord-input-sm" />
              </div>
              <button class="btn-primary full-width" onclick="window.addLineByCoords()">+ Nakreslit</button>
            </div>
          </div>

          <!-- Kru≈ænice -->
          <div class="section-wrapper">
            <div class="section-header" onclick="window.toggleCoordSection('coordCircle')">
              <strong class="section-title">‚≠ï Kru≈ænice</strong>
              <span id="coordCircleToggle" class="section-toggle">‚ñº</span>
            </div>
            <div id="coordCircle" class="section-content">
              <div class="input-label">St≈ôed:</div>
              <div class="flex-gap-8 mb-8">
                <input type="number" id="quickCircleZ" placeholder="Z" step="0.01" class="coord-input" />
                <input type="number" id="quickCircleX" placeholder="X" step="0.01" class="coord-input" />
              </div>
              <div class="input-label">Polomƒõr:</div>
              <input type="number" id="quickCircleR" placeholder="R" step="0.01" class="coord-input-full" />
              <button class="btn-primary full-width" onclick="window.quickAddCircle()">+ Nakreslit</button>
            </div>
          </div>

          <!-- Pol√°rn√≠ sou≈ôadnice -->
          <div class="section-wrapper">
            <div class="section-header" onclick="window.toggleCoordSection('coordPolar')">
              <strong class="section-title">üìê Pol√°rn√≠</strong>
              <span id="coordPolarToggle" class="section-toggle">‚ñº</span>
            </div>
            <div id="coordPolar" class="section-content">
              <div class="input-label">Poƒç√°teƒçn√≠ bod:</div>
              <div class="flex-gap-8 mb-8">
                <input type="number" id="polarStartZ" placeholder="Z" step="0.01" class="coord-input" />
                <input type="number" id="polarStartX" placeholder="X" step="0.01" class="coord-input" />
              </div>
              <div class="flex-gap-8 mb-8">
                <div class="flex-1">
                  <div class="input-label-sm">Vzd√°lenost:</div>
                  <input type="number" id="polarDist" placeholder="mm" step="0.1" class="coord-input-full" />
                </div>
                <div class="flex-1">
                  <div class="input-label-sm">√öhel:</div>
                  <input type="number" id="polarAngle" placeholder="¬∞" step="1" class="coord-input-full" />
                </div>
              </div>
              <div class="input-hint">0¬∞ = vpravo, 90¬∞ = nahoru</div>
              <div class="flex-gap-8">
                <button class="btn-primary" onclick="window.addLinePolar()">+ ƒå√°ra</button>
                <button class="btn-primary" onclick="window.addPointPolar()">+ Bod</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Ostatn√≠ panel -->
      <div class="tool-submenu d-none" id="toolsOther" style="display: none;">
        <div class="tool-submenu-panel max-w-500 max-h-70vh">
          <!-- Akce -->
          <div class="section-wrapper">
            <div class="section-header-static">
              <strong class="section-title">‚ö° Akce</strong>
            </div>
            <div class="flex-wrap-center mt-8">
              <button class="tool-btn no-margin flex-1 min-w-80" onclick="window.undo()" title="Zpƒõt">
                <span class="tool-btn-icon-lg">‚Ü∂</span>
                <div class="tool-btn-label-sm">Zpƒõt</div>
              </button>
              <button class="tool-btn no-margin flex-1 min-w-80" onclick="window.clearAll()" title="Vymazat v≈°e">
                <span class="tool-btn-icon-lg">üóëÔ∏è</span>
                <div class="tool-btn-label-sm">Vymazat</div>
              </button>
              <button class="tool-btn no-margin flex-1 min-w-80" onclick="window.exportPNG()" title="Exportovat PNG">
                <span class="tool-btn-icon-lg">üíæ</span>
                <div class="tool-btn-label-sm">Export PNG</div>
              </button>
            </div>
            <div class="flex-wrap-center mt-8">
              <button class="tool-btn no-margin flex-1 min-w-100" onclick="window.saveProject()" title="Ulo≈æit projekt">
                <span class="tool-btn-icon-lg">üíæ</span>
                <div class="tool-btn-label">Ulo≈æit</div>
              </button>
              <button class="tool-btn no-margin flex-1 min-w-100" onclick="document.getElementById('loadProjectInput').click()" title="Naƒç√≠st projekt">
                <span class="tool-btn-icon-lg">üìÇ</span>
                <div class="tool-btn-label">Naƒç√≠st</div>
              </button>
              <button class="tool-btn no-margin flex-1 min-w-120" onclick="document.getElementById('importSimDxfInput').click()" title="Importovat z SimDxf JSON">
                <span class="tool-btn-icon-lg">üì•</span>
                <div class="tool-btn-label">Import SimDxf</div>
              </button>
              <input type="file" id="loadProjectInput" accept=".json" class="d-none" onchange="window.loadProject(this)" />
              <input type="file" id="importSimDxfInput" accept=".json" class="d-none" onchange="window.importSimDxfProject(this)" />
            </div>
          </div>

          <!-- P≈ôichycen√≠ -->
          <div class="section-wrapper">
            <div class="section-header" onclick="window.toggleCoordSection('otherHelpers')">
              <strong class="section-title">üìç P≈ôichycen√≠</strong>
              <span id="otherHelpersToggle" class="section-toggle">‚ñº</span>
            </div>
            <div id="otherHelpers" class="section-content">
              <label class="checkbox-label mb-8">
                <input type="checkbox" id="snapGrid" onchange="window.updateSnapSettings()" class="checkbox-lg" />
                <span>P≈ôichycen√≠ k m≈ô√≠≈æce</span>
              </label>
              <label class="checkbox-label mb-8">
                <input type="checkbox" id="snapPoints" checked onchange="window.updateSnapSettings()" class="checkbox-lg" />
                <span>P≈ôichycen√≠ k bod≈Øm</span>
              </label>
              <label class="checkbox-label">
                <input type="checkbox" id="orthoMode" checked onchange="window.updateSnapSettings()" class="checkbox-lg" />
                <span>Ortogon√°ln√≠ (‚Üî‚Üï)</span>
              </label>
            </div>
          </div>

          <!-- Zobrazen√≠ -->
          <div class="section-wrapper">
            <div class="section-header" onclick="window.toggleCoordSection('otherDisplay')">
              <strong class="section-title">üé® Zobrazen√≠</strong>
              <span id="otherDisplayToggle" class="section-toggle">‚ñº</span>
            </div>
            <div id="otherDisplay" class="section-content">
              <label class="checkbox-label mb-8">
                <input type="checkbox" id="showGrid" checked onchange="window.draw()" class="checkbox-lg" />
                <span>M≈ô√≠≈æka</span>
              </label>
              <label class="checkbox-label mb-8">
                <input type="checkbox" id="showAxes" checked onchange="window.draw()" class="checkbox-lg" />
                <span>Osy (X, Z)</span>
              </label>
              <label class="checkbox-label mb-8">
                <input type="checkbox" id="showPoints" checked onchange="window.draw()" class="checkbox-lg" />
                <span>Body</span>
              </label>
              <label class="checkbox-label mb-8">
                <input type="checkbox" id="enableMeasureInput" onchange="window.toggleMeasureInput()" class="checkbox-lg" />
                <span>M√≠ra - zad√°n√≠ rozmƒõr≈Ø</span>
              </label>
              <!-- M≈ô√≠≈æka -->
              <div class="section-divider">
                <label class="input-label" style="display: block; margin-bottom: 6px">Rozestup m≈ô√≠≈æky (mm):</label>
                <input type="number" id="gridSpacing" value="10" min="0.01" max="100" step="0.01" onchange="window.updateGridSpacing()" class="coord-input-full" />
                <div class="flex-gap-8" style="margin-top: 6px">
                  <button class="btn-grid-preset" onclick="window.setGridSpacing(0.1)">0.1mm</button>
                  <button class="btn-grid-preset" onclick="window.setGridSpacing(1)">1mm</button>
                  <button class="btn-grid-preset" onclick="window.setGridSpacing(5)">5mm</button>
                  <button class="btn-grid-preset" onclick="window.setGridSpacing(10)">10mm</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <canvas id="canvas"></canvas>

      <!-- Touch cursor -->
      <div class="touch-cursor" id="touchCursor">
        <div class="touch-cursor-center"></div>
      </div>

      <!-- Precision mode elements -->
      <div class="precision-line" id="precisionLine"></div>
      <div class="precision-finger-indicator" id="precisionFinger"></div>

      <div class="coords" id="coords">Z: 0.00 | X: 0.00 mm</div>
      <div class="snap-info" id="snapInfo"></div>
      <div class="mode-info" id="modeInfo"></div>
    </div>

    <!-- Toolbar dole -->
    <div class="toolbar">
      <button class="tool-btn" onclick="window.showControllerModal()" id="btnController" title="Ovladaƒç pro kreslen√≠">
        <span class="toolbar-btn-icon">üéÆ</span>
        <div class="toolbar-btn-label">Ovladaƒç</div>
      </button>
      <button class="tool-btn" onclick="window.showToolCategory('drawing')" id="btnCatDrawing" title="Kreslen√≠">
        <span class="toolbar-btn-icon">‚úèÔ∏è</span>
        <div class="toolbar-btn-label">Kreslen√≠</div>
      </button>
      <button class="tool-btn" onclick="window.showToolCategory('edit')" id="btnCatEdit" title="√öpravy">
        <span class="toolbar-btn-icon">üîß</span>
        <div class="toolbar-btn-label">√öpravy</div>
      </button>
      <button class="tool-btn" onclick="window.showToolCategory('coords')" id="btnCatCoords" title="Sou≈ôadnice">
        <span class="toolbar-btn-icon">üìê</span>
        <div class="toolbar-btn-label">Sou≈ôadnice</div>
      </button>
      <button class="tool-btn" onclick="window.showToolCategory('other')" id="btnCatOther" title="Ostatn√≠">
        <span class="toolbar-btn-icon">‚öôÔ∏è</span>
        <div class="toolbar-btn-label">Ostatn√≠</div>
      </button>

      <div class="toolbar-divider"></div>

      <button class="tool-btn ai-btn" onclick="window.showToolCategory('ai')" id="btnCatAi" title="AI Asistent">
        <span class="toolbar-btn-icon">‚ú®</span>
        <div class="toolbar-btn-label">AI</div>
      </button>
    </div>
    <div id="settingsModal" class="modal-overlay">
      <div class="modal-window">
        <!-- K≈ô√≠≈æek na zav≈ôen√≠ -->
        <button class="modal-close-btn" onclick="closeSettings()" title="Zav≈ô√≠t">√ó</button>

        <h2 class="modal-title">
          ‚öôÔ∏è Nastaven√≠ API Kl√≠ƒç≈Ø
        </h2>

        <p class="modal-subtitle">
          Pro pou≈æit√≠ AI funkc√≠ vlo≈æte API kl√≠ƒçe. Kl√≠ƒçe jsou ulo≈æeny
          pouze ve va≈°em prohl√≠≈æeƒçi.
        </p>

        <!-- Provider Tabs -->
        <div class="provider-tabs">
          <button id="tabGemini" onclick="window.switchProviderTab('gemini')" class="provider-tab active">
            ü§ñ Gemini
          </button>
          <button id="tabGroq" onclick="window.switchProviderTab('groq')" class="provider-tab">
            ‚ö° Groq
          </button>
          <button id="tabOpenRouter" onclick="window.switchProviderTab('openrouter')" class="provider-tab">
            üåê OpenRouter
          </button>
          <button id="tabMistral" onclick="window.switchProviderTab('mistral')" class="provider-tab">
            üî• Mistral
          </button>
        </div>

        <!-- Gemini Tab Content -->
        <div id="geminiTabContent">
          <p class="modal-description">
            <a href="https://aistudio.google.com/app/apikey" target="_blank" class="link-primary">Z√≠skat Gemini kl√≠ƒç zde</a>
          </p>

          <div class="modal-description">Gemini kl√≠ƒçe:</div>
          <div id="keyList" class="key-list">
            <div class="empty-state">≈Ω√°dn√© kl√≠ƒçe</div>
          </div>

          <div class="key-form-container">
            <div class="form-group">
              <label class="form-label">N√°zev:</label>
              <input type="text" id="newKeyName" placeholder="M≈Øj Gemini kl√≠ƒç" class="form-input" />
            </div>
            <div class="form-group">
              <label class="form-label">API Key:</label>
              <input type="password" id="newKeyValue" placeholder="AIza..." class="form-input" />
            </div>
            <button onclick="addApiKey()" class="btn-full">+ P≈ôidat a pou≈æ√≠t</button>
          </div>
        </div>

        <!-- Groq Tab Content -->
        <div id="groqTabContent" class="d-none">
          <p class="modal-description">
            <a href="https://console.groq.com/keys" target="_blank" class="link-primary">Z√≠skat Groq kl√≠ƒç zde</a>
          </p>

          <div class="modal-description">Groq kl√≠ƒçe:</div>
          <div id="groqKeyList" class="key-list">
            <div class="empty-state">≈Ω√°dn√© kl√≠ƒçe</div>
          </div>

          <div class="key-form-container">
            <div class="form-group">
              <label class="form-label">N√°zev:</label>
              <input type="text" id="newGroqKeyName" placeholder="M≈Øj Groq kl√≠ƒç" class="form-input" />
            </div>
            <div class="form-group">
              <label class="form-label">API Key:</label>
              <input type="password" id="newGroqKeyValue" placeholder="gsk_..." class="form-input" />
            </div>
            <button onclick="addGroqApiKey()" class="btn-full">+ P≈ôidat a pou≈æ√≠t</button>
          </div>
        </div>

        <!-- OpenRouter Tab Content -->
        <div id="openrouterTabContent" class="d-none">
          <p class="modal-description">
            <a href="https://openrouter.ai/keys" target="_blank" class="link-primary">Z√≠skat OpenRouter kl√≠ƒç zde</a>
          </p>

          <div class="modal-description">OpenRouter kl√≠ƒçe:</div>
          <div id="openrouterKeyList" class="key-list">
            <div class="empty-state">≈Ω√°dn√© kl√≠ƒçe</div>
          </div>

          <div class="key-form-container">
            <div class="form-group">
              <label class="form-label">N√°zev:</label>
              <input type="text" id="newOpenRouterKeyName" placeholder="M≈Øj OpenRouter kl√≠ƒç" class="form-input" />
            </div>
            <div class="form-group">
              <label class="form-label">API Key:</label>
              <input type="password" id="newOpenRouterKeyValue" placeholder="sk-or-v1-..." class="form-input" />
            </div>
            <button onclick="addOpenRouterApiKey()" class="btn-full">+ P≈ôidat a pou≈æ√≠t</button>
          </div>
        </div>

        <!-- Mistral Tab Content -->
        <div id="mistralTabContent" class="d-none">
          <p class="modal-description">
            <a href="https://console.mistral.ai/api-keys/" target="_blank" class="link-primary">Z√≠skat Mistral kl√≠ƒç zde</a>
          </p>

          <div class="modal-description">Mistral kl√≠ƒçe:</div>
          <div id="mistralKeyList" class="key-list">
            <div class="empty-state">≈Ω√°dn√© kl√≠ƒçe</div>
          </div>

          <div class="key-form-container">
            <div class="form-group">
              <label class="form-label">N√°zev:</label>
              <input type="text" id="newMistralKeyName" placeholder="M≈Øj Mistral kl√≠ƒç" class="form-input" />
            </div>
            <div class="form-group">
              <label class="form-label">API Key:</label>
              <input type="password" id="newMistralKeyValue" placeholder="Tvwm..." class="form-input" />
            </div>
            <button onclick="addMistralApiKey()" class="btn-full">+ P≈ôidat a pou≈æ√≠t</button>
          </div>
        </div>

        <!-- Test a spr√°va AI model≈Ø -->
        <div class="test-panel">
          <h3 class="test-panel-title">
            <span class="tool-btn-icon">üß™</span>
            Test a spr√°va model≈Ø
          </h3>
          <p class="test-panel-description">
            Otestuj modely nebo vyber kter√© chce≈° pou≈æ√≠vat.
          </p>
          <div class="flex-gap-8">
            <button onclick="window.testAllAIModels()" class="btn-test">üöÄ Test model≈Ø</button>
            <button onclick="window.openModelManager()" class="btn-manage">‚öôÔ∏è Spr√°va model≈Ø</button>
          </div>
        </div>
      </div>
    </div>

    <!-- AI PREFERENCES MODAL -->
    <div id="aiPreferencesModal" class="modal-overlay d-none">
      <div class="modal-window">
        <h2 class="modal-title">üéì AI Preference</h2>

        <p class="modal-subtitle">
          Nastavte sv√© preference a AI se nauƒç√≠ je respektovat.
        </p>

        <div class="key-form-container mb-8">
          <h3 class="section-title mb-8">üìù Preference:</h3>
          <div id="preferencesList" class="preferences-list">
            <div class="empty-state">≈Ω√°dn√© preference</div>
          </div>
        </div>

        <div class="key-form-container">
          <h3 class="section-title mb-8">‚ûï P≈ôidat preferenci:</h3>
          <div class="form-group">
            <label class="form-label">Kl√≠ƒç:</label>
            <input type="text" id="newPrefKey" class="form-input"
              placeholder="nap≈ô. material"
              style="
                width: 100%;
                background: #111;
                border: 1px solid #444;
                color: white;
                padding: 6px;
                border-radius: 4px;
              "
            />
          </div>
          <div class="mb-8">
            <label style="font-size: 11px; display: block; margin-bottom: 2px"
              >Hodnota:</label
            >
            <input
              type="text"
              id="newPrefValue"
              placeholder="nap≈ô. ocel"
              style="
                width: 100%;
                background: #111;
                border: 1px solid #444;
                color: white;
                padding: 6px;
                border-radius: 4px;
              "
            />
          </div>
          <button
            onclick="addAIPreference()"
            style="
              width: 100%;
              padding: 8px;
              background: #3a7bc8;
              color: white;
              border: none;
              border-radius: 4px;
              cursor: pointer;
              font-size: 13px;
            "
          >
            + P≈ôidat
          </button>
        </div>

        <div style="margin-top: 15px; text-align: right">
          <button
            onclick="closeAIPreferences()"
            style="
              padding: 8px 16px;
              background: #444;
              color: white;
              border: none;
              border-radius: 4px;
              cursor: pointer;
            "
          >
            Zav≈ô√≠t
          </button>
        </div>
      </div>
    </div>

    <!-- AI MODEL TEST RESULTS MODAL -->
    <div id="aiTestResultsModal" class="modal-overlay d-none">
      <div class="modal-window modal-lg">
        <div class="modal-header">
          <h2 class="modal-header-title">
            <span class="toolbar-btn-icon">üß™</span>
            V√Ωsledky testov√°n√≠ AI model≈Ø
          </h2>
          <button onclick="window.closeAITestResults()" class="modal-close-btn-simple">&times;</button>
        </div>

        <div id="aiTestResultsContent" class="mb-20">
          <!-- Obsah se vypln√≠ dynamicky -->
        </div>

        <div class="modal-footer">
          <button onclick="window.copyAITestReport()" class="btn-copy-report">üìã Zkop√≠rovat Report</button>
          <button onclick="window.closeAITestResults()" class="btn-cancel">Zav≈ô√≠t</button>
        </div>
      </div>
    </div>

    <!-- AI MODEL MANAGER MODAL -->
    <div id="modelManagerModal" class="modal-overlay d-none">
      <div class="modal-window modal-md">
        <div class="modal-header">
          <h2 class="modal-header-title">
            <span class="toolbar-btn-icon">‚öôÔ∏è</span>
            Spr√°va AI model≈Ø
          </h2>
          <button onclick="window.closeModelManager()" class="modal-close-btn-simple">&times;</button>
        </div>

        <div class="info-panel">
          <p class="info-panel-text">üìå Za≈°krtni modely, kter√© chce≈° pou≈æ√≠vat. Ostatn√≠ budou skryt√© v seznamu model≈Ø.</p>
        </div>

        <div id="modelManagerContent">
          <!-- Obsah se vypln√≠ dynamicky -->
        </div>

        <div class="modal-footer-space-between">
          <div class="flex-gap-8">
            <button onclick="window.selectAllModels(true)" class="btn-select-all">‚úì V≈°e</button>
            <button onclick="window.selectAllModels(false)" class="btn-select-none">‚úó Nic</button>
          </div>
          <button onclick="window.closeModelManager()" class="btn-cancel">Zav≈ô√≠t</button>
        </div>
      </div>
    </div>

    <!-- CIRCLE MODAL -->
    <div id="circleModal" class="modal-overlay">
      <div class="modal-window">
        <h2 class="modal-title">‚≠ï Zad√°n√≠ kru≈ænice</h2>
        <div class="circle-input-row">
          <label>Polomƒõr (R):</label>
          <input type="number" id="circleInputR" step="0.01" oninput="window.updateCircleInputs('R')" onkeydown="if(event.key==='Enter') window.confirmCircle()" />
        </div>
        <div class="circle-input-row">
          <label>Pr≈Ømƒõr (D):</label>
          <input type="number" id="circleInputD" step="0.01" oninput="window.updateCircleInputs('D')" onkeydown="if(event.key==='Enter') window.confirmCircle()" />
        </div>
        <div class="modal-footer mt-15">
          <button onclick="window.closeCircleModal()" class="btn-cancel">Zru≈°it</button>
          <button onclick="window.confirmCircle()" class="btn-confirm">Vytvo≈ôit</button>
        </div>
      </div>
    </div>

    <!-- CONSTRAINT MODAL -->
    <!-- COLOR & STYLE MODAL -->
    <div id="colorStyleModal" class="modal-overlay d-none">
      <div class="modal-window modal-md">
        <h2 class="modal-title">üé® Barva a Styl ƒå√°ry</h2>

        <!-- BARVY -->
        <div class="mb-20">
          <h3 class="section-header-sm">üé® Barva</h3>
          <div class="flex-wrap-gap-10">
            <button onclick="window.selectColor('#FF0000', this)" id="colorBtn_FF0000" class="color-btn" style="background: #FF0000" title="ƒåerven√°"></button>
            <button onclick="window.selectColor('#00FF00', this)" id="colorBtn_00FF00" class="color-btn" style="background: #00FF00" title="Zelen√°"></button>
            <button onclick="window.selectColor('#0000FF', this)" id="colorBtn_0000FF" class="color-btn" style="background: #0000FF" title="Modr√°"></button>
            <button onclick="window.selectColor('#FFFF00', this)" id="colorBtn_FFFF00" class="color-btn" style="background: #FFFF00" title="≈Ωlut√°"></button>
            <button onclick="window.selectColor('#FF00FF', this)" id="colorBtn_FF00FF" class="color-btn" style="background: #FF00FF" title="Fialov√°"></button>
            <button onclick="window.selectColor('#00FFFF', this)" id="colorBtn_00FFFF" class="color-btn" style="background: #00FFFF" title="Azurov√°"></button>
            <button onclick="window.selectColor('#FFA500', this)" id="colorBtn_FFA500" class="color-btn" style="background: #FFA500" title="Oran≈æov√°"></button>
            <button onclick="window.selectColor('#800080', this)" id="colorBtn_800080" class="color-btn" style="background: #800080" title="Purpura"></button>
            <button onclick="window.selectColor('#FFFFFF', this)" id="colorBtn_FFFFFF" class="color-btn" style="background: #FFFFFF" title="B√≠l√°"></button>
            <button onclick="window.selectColor('#000000', this)" id="colorBtn_000000" class="color-btn color-btn-dark" style="background: #000000" title="ƒåern√°"></button>
            <button onclick="window.selectColor('#808080', this)" id="colorBtn_808080" class="color-btn" style="background: #808080" title="≈†ed√°"></button>
            <button onclick="window.selectColor('#FF69B4', this)" id="colorBtn_FF69B4" class="color-btn" style="background: #FF69B4" title="R≈Ø≈æov√°"></button>
          </div>
        </div>

        <!-- STYL ƒå√ÅRY -->
        <div class="mb-20">
          <h3 class="section-header-sm">üìè Styl ƒå√°ry</h3>
          <div class="flex-wrap-gap-10">
            <button onclick="window.selectLineStyle('solid', this)" id="styleBtn_solid" class="line-style-btn">‚îÅ‚îÅ Klasick√°</button>
            <button onclick="window.selectLineStyle('thick', this)" id="styleBtn_thick" class="line-style-btn">‚îÅ‚îÅ‚îÅ Tlust√°</button>
            <button onclick="window.selectLineStyle('thin', this)" id="styleBtn_thin" class="line-style-btn">‚îÄ Tenk√°</button>
            <button onclick="window.selectLineStyle('dashed', this)" id="styleBtn_dashed" class="line-style-btn">‚ïå ‚ïå ƒå√°rkovan√°</button>
            <button onclick="window.selectLineStyle('dotted', this)" id="styleBtn_dotted" class="line-style-btn">¬∑ ¬∑ Teƒçkovan√°</button>
          </div>
        </div>

        <!-- NASTAVEN√ç V√ùCHOZ√çCH BAREV A STYLU -->
        <div class="settings-section">
          <h3 class="section-header-sm">‚öôÔ∏è Nastaven√≠ Kreslen√≠ Nov√Ωch Objekt≈Ø</h3>
          <p class="settings-description">Vyberte v√Ωchoz√≠ barvu a styl pro novƒõ kreslen√© objekty. Nastaven√≠ se ulo≈æ√≠ automaticky.</p>

          <div class="settings-grid">
            <!-- V√Ωchoz√≠ barva -->
            <div>
              <label class="settings-label">üé® V√Ωchoz√≠ barva:</label>
              <select id="defaultColorSelect" onchange="window.setDefaultColor(this.value)" class="settings-select">
                <option value="#4a9eff">üîµ Modr√° (v√Ωchoz√≠)</option>
                <option value="#FF0000">üî¥ ƒåerven√°</option>
                <option value="#00FF00">üü¢ Zelen√°</option>
                <option value="#FFFF00">üü° ≈Ωlut√°</option>
                <option value="#FF00FF">üü£ Fialov√°</option>
                <option value="#00FFFF">‚ö™ Azurov√°</option>
                <option value="#FFA500">üü† Oran≈æov√°</option>
                <option value="#800080">‚¨õ Purpura</option>
                <option value="#FFFFFF">‚ö´ B√≠l√°</option>
                <option value="#000000">‚¨ú ƒåern√°</option>
                <option value="#808080">‚óºÔ∏è ≈†ed√°</option>
                <option value="#FF69B4">ü©∑ R≈Ø≈æov√°</option>
              </select>
            </div>

            <!-- V√Ωchoz√≠ styl ƒç√°ry -->
            <div>
              <label class="settings-label">üìè V√Ωchoz√≠ styl ƒç√°ry:</label>
              <select id="defaultLineStyleSelect" onchange="window.setDefaultLineStyle(this.value)" class="settings-select">
                <option value="solid">‚îÅ‚îÅ Klasick√°</option>
                <option value="thick">‚îÅ‚îÅ‚îÅ Tlust√°</option>
                <option value="thin">‚îÄ Tenk√°</option>
                <option value="dashed">‚ïå ‚ïå ƒå√°rkovan√°</option>
                <option value="dotted">¬∑ ¬∑ Teƒçkovan√°</option>
              </select>
            </div>
          </div>
        </div>

        <!-- NASTAVEN√ç BAREV K√ìT -->
        <div class="settings-section">
          <h3 class="section-header-sm">üìè Nastaven√≠ Barev K√≥t</h3>
          <p class="settings-description">Vyberte barvy pro k√≥ty a jejich hodnoty. Nastaven√≠ se ulo≈æ√≠ automaticky.</p>

          <div class="settings-grid">
            <!-- Barva ƒçar k√≥t -->
            <div>
              <label class="settings-label">üìê Barva ƒçar k√≥t:</label>
              <select id="dimensionLineColorSelect" onchange="window.setDimensionLineColor(this.value)" class="settings-select">
                <option value="#ffa500">üü† Oran≈æov√° (v√Ωchoz√≠)</option>
                <option value="#FF0000">üî¥ ƒåerven√°</option>
                <option value="#00FF00">üü¢ Zelen√°</option>
                <option value="#4a9eff">üîµ Modr√°</option>
                <option value="#FFFF00">üü° ≈Ωlut√°</option>
                <option value="#FF00FF">üü£ Fialov√°</option>
                <option value="#00FFFF">‚ö™ Azurov√°</option>
                <option value="#FFFFFF">‚ö´ B√≠l√°</option>
                <option value="#000000">‚¨ú ƒåern√°</option>
                <option value="#808080">‚óºÔ∏è ≈†ed√°</option>
              </select>
            </div>

            <!-- Barva hodnot k√≥t -->
            <div>
              <label class="settings-label">üî§ Barva hodnot k√≥t:</label>
              <select id="dimensionTextColorSelect" onchange="window.setDimensionTextColor(this.value)" class="settings-select">
                <option value="#ffff99">üü° Svƒõtle ≈ælut√° (v√Ωchoz√≠)</option>
                <option value="#FFFFFF">‚ö´ B√≠l√°</option>
                <option value="#000000">‚¨ú ƒåern√°</option>
                <option value="#FF0000">üî¥ ƒåerven√°</option>
                <option value="#00FF00">üü¢ Zelen√°</option>
                <option value="#4a9eff">üîµ Modr√°</option>
                <option value="#FFA500">üü† Oran≈æov√°</option>
              </select>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button onclick="window.closeColorStyleModal()" class="btn-cancel">Zru≈°it</button>
          <button onclick="window.confirmColorStyle()" class="btn-confirm">Potvrdit</button>
        </div>
      </div>
    </div>

    <div id="constraintModal" class="modal-overlay">
      <div class="modal-window">
        <h2 class="modal-title">üîí Fixace - Aretov√°n√≠ objekt≈Ø</h2>
        <p class="modal-description">Vyberte typ fixace pro aretov√°n√≠ vybran√Ωch objekt≈Ø</p>
        <div class="constraint-btn-container">
          <button onclick="window.applyConstraint('point')" class="constraint-btn">üìç Bod</button>
          <button onclick="window.applyConstraint('distance')" class="constraint-btn">üìè Vzd√°lenost</button>
          <button onclick="window.applyConstraint('radius')" class="constraint-btn">‚≠ï Radius</button>
          <button onclick="window.applyConstraint('polarAngle')" class="constraint-btn">‚ü≤ Pol. √öhel</button>
          <button onclick="window.applyConstraint('horizontal')" class="constraint-btn">‚û°Ô∏è Vodorovnƒõ</button>
          <button onclick="window.applyConstraint('vertical')" class="constraint-btn">‚¨ÜÔ∏è Svisle</button>
          <button onclick="window.removeConstraint('all')" class="constraint-btn-delete">‚ùå Smazat</button>
        </div>
        <div class="modal-footer mt-15">
          <button onclick="window.closeConstraintModal()" class="btn-cancel">Zav≈ô√≠t</button>
        </div>
      </div>
    </div>

    <!-- CONSTRAINT POINT MODAL -->
    <div id="constraintPointModal" class="modal-overlay">
      <div class="modal-window">
        <h2 class="modal-title">üìç Fixace Bodu - Zad√°n√≠ Sou≈ôadnic</h2>
        <div class="circle-input-row">
          <label>Z (Horizont√°lnƒõ):</label>
          <input type="number" id="constraintPointZ" step="0.01" value="0" />
        </div>
        <div class="circle-input-row">
          <label>X (Vertik√°lnƒõ):</label>
          <input type="number" id="constraintPointX" step="0.01" value="0" />
        </div>
        <div class="modal-footer mt-15">
          <button onclick="window.cancelConstraintValue()" class="btn-cancel">Zru≈°it</button>
          <button onclick="window.confirmConstraintPoint()" class="btn-confirm">Potvrdit</button>
        </div>
      </div>
    </div>

    <!-- CONSTRAINT DISTANCE MODAL -->
    <div id="constraintDistanceModal" class="modal-overlay">
      <div class="modal-window">
        <h2 class="modal-title">üìè Fixace Vzd√°lenosti</h2>
        <div class="circle-input-row">
          <label>Vzd√°lenost:</label>
          <input type="number" id="constraintDistanceValue" step="0.01" value="10" />
        </div>
        <div class="modal-footer mt-15">
          <button onclick="window.cancelConstraintValue()" class="btn-cancel">Zru≈°it</button>
          <button onclick="window.confirmConstraintDistance()" class="btn-confirm">Potvrdit</button>
        </div>
      </div>
    </div>

    <!-- CONSTRAINT RADIUS MODAL -->
    <div id="constraintRadiusModal" class="modal-overlay">
      <div class="modal-window">
        <h2 class="modal-title">‚≠ï Fixace Radiusu</h2>
        <div class="circle-input-row">
          <label>Radius:</label>
          <input type="number" id="constraintRadiusValue" step="0.01" value="5" />
        </div>
        <div class="modal-footer mt-15">
          <button onclick="window.cancelConstraintValue()" class="btn-cancel">Zru≈°it</button>
          <button onclick="window.confirmConstraintRadius()" class="btn-confirm">Potvrdit</button>
        </div>
      </div>
    </div>

    <!-- CONSTRAINT POLAR ANGLE MODAL -->
    <div id="constraintPolarAngleModal" class="modal-overlay">
      <div class="modal-window">
        <h2 class="modal-title">‚ü≤ Fixace Pol√°rn√≠ho √öhlu</h2>
        <div class="circle-input-row">
          <label>Pol√°rn√≠ √öhel (¬∞):</label>
          <input type="number" id="constraintPolarAngleValue" step="0.1" value="0" min="0" max="360" />
        </div>
        <div class="modal-footer mt-15">
          <button onclick="window.cancelConstraintValue()" class="btn-cancel">Zru≈°it</button>
          <button onclick="window.confirmConstraintPolarAngle()" class="btn-confirm">Potvrdit</button>
        </div>
      </div>
    </div>

    <!-- MODALS PLACEHOLDER - Ostatn√≠ mod√°ly se naƒç√≠taj√≠ z external soubor≈Ø -->
    <div id="quickInputHelpModal" class="modal-overlay"></div>
    <div id="controllerModal" class="modal-overlay controller-modal">
      <div class="modal-window controller-window">
        <div class="controller-header">
          <h2 class="modal-title no-margin">üéÆ Ovladaƒç - Rychl√© kreslen√≠ √∫seƒçek</h2>
          <button onclick="window.closeControllerModal()" class="modal-close-btn-simple">&times;</button>
        </div>

        <!-- Input Display & Mode Selector -->
        <div class="mb-12">
          <div class="flex-gap-8 mb-8">
            <button id="btnG90" onclick="window.setControllerMode('G90')" class="controller-mode-btn active">
              G90<br /><span class="ctrl-btn-sublabel">Absolutn√≠</span>
            </button>
            <button id="btnG91" onclick="window.setControllerMode('G91')" class="controller-mode-btn inactive">
              G91<br /><span class="ctrl-btn-sublabel">P≈ô√≠r≈Østkov√©</span>
            </button>
            <input type="text" id="controllerInput" readonly placeholder="Zad√°n√≠..." class="controller-input" />
          </div>
          <div class="flex-gap-10 text-info">
            <div><strong class="text-primary">Re≈æim:</strong> <span id="controllerModeDisplay">G90 (Absolutn√≠)</span></div>
            <div><strong class="text-primary">Posledn√≠ bod:</strong> <span id="controllerLastPointInline">‚Äî</span></div>
          </div>
        </div>

        <!-- Controller Layout - KL√ÅVESNICE -->
        <div style="background: #1a1a1a; padding: 12px; border-radius: 10px; border: 1px solid #444">
          <h4 style="color: #90cdf4; margin: 0 0 8px 0; text-align: center; font-size: 12px">‚å®Ô∏è CNC Zad√°n√≠</h4>

          <!-- G-Codes Row -->
          <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 3px; margin-bottom: 3px">
            <button onclick="window.insertControllerToken('G90 ')" class="ctrl-btn ctrl-btn-gcode">G90<span class="ctrl-btn-sublabel">Abs</span></button>
            <button onclick="window.insertControllerToken('G91 ')" class="ctrl-btn ctrl-btn-gcode">G91<span class="ctrl-btn-sublabel">P≈ô√≠r</span></button>
            <button onclick="window.insertControllerToken('G0 ')" class="ctrl-btn ctrl-btn-gcode">G0<span class="ctrl-btn-sublabel">Bod</span></button>
            <button onclick="window.insertControllerToken('G1 ')" class="ctrl-btn ctrl-btn-gcode">G1<span class="ctrl-btn-sublabel">ƒå√°ra</span></button>
            <button onclick="window.insertControllerToken('G2 ')" class="ctrl-btn ctrl-btn-gcode">G2<span class="ctrl-btn-sublabel">CW</span></button>
            <button onclick="window.insertControllerToken('G3 ')" class="ctrl-btn ctrl-btn-gcode">G3<span class="ctrl-btn-sublabel">CCW</span></button>
          </div>

          <!-- Row 1: X, Z, 7, 8, 9, ; -->
          <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 3px; margin-bottom: 3px">
            <button onclick="window.insertControllerToken('X')" class="ctrl-btn">X<span class="ctrl-btn-sublabel">Osa</span></button>
            <button onclick="window.insertControllerToken('Z')" class="ctrl-btn">Z<span class="ctrl-btn-sublabel">Osa</span></button>
            <button onclick="window.insertControllerToken('7')" class="ctrl-btn ctrl-btn-num">7</button>
            <button onclick="window.insertControllerToken('8')" class="ctrl-btn ctrl-btn-num">8</button>
            <button onclick="window.insertControllerToken('9')" class="ctrl-btn ctrl-btn-num">9</button>
            <button onclick="window.insertControllerToken(';')" class="ctrl-btn">;<span class="ctrl-btn-sublabel">Odd</span></button>
          </div>

          <!-- Row 2: R, CR, 4, 5, 6, Space -->
          <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 3px; margin-bottom: 3px">
            <button onclick="window.insertControllerToken('R')" class="ctrl-btn">R<span class="ctrl-btn-sublabel">Rad</span></button>
            <button onclick="window.insertControllerToken('CR')" class="ctrl-btn">CR<span class="ctrl-btn-sublabel">Min</span></button>
            <button onclick="window.insertControllerToken('4')" class="ctrl-btn ctrl-btn-num">4</button>
            <button onclick="window.insertControllerToken('5')" class="ctrl-btn ctrl-btn-num">5</button>
            <button onclick="window.insertControllerToken('6')" class="ctrl-btn ctrl-btn-num">6</button>
            <button onclick="window.insertControllerToken(' ')" class="ctrl-btn">‚ê£<span class="ctrl-btn-sublabel">Mezera</span></button>
          </div>

          <!-- Row 3: L, A, 1, 2, 3, Backspace -->
          <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 3px; margin-bottom: 3px">
            <button onclick="window.insertControllerToken('L')" class="ctrl-btn">L<span class="ctrl-btn-sublabel">D√©l</span></button>
            <button onclick="window.insertControllerToken('A')" class="ctrl-btn">A<span class="ctrl-btn-sublabel">√öhel</span></button>
            <button onclick="window.insertControllerToken('1')" class="ctrl-btn ctrl-btn-num">1</button>
            <button onclick="window.insertControllerToken('2')" class="ctrl-btn ctrl-btn-num">2</button>
            <button onclick="window.insertControllerToken('3')" class="ctrl-btn ctrl-btn-num">3</button>
            <button onclick="window.backspaceControllerToken()" class="ctrl-btn ctrl-btn-delete">‚å´</button>
          </div>

          <!-- Row 4: RP, AP, -, 0, . -->
          <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 3px; margin-bottom: 6px">
            <button onclick="window.insertControllerToken('RP')" class="ctrl-btn">RP<span class="ctrl-btn-sublabel">Pol</span></button>
            <button onclick="window.insertControllerToken('AP')" class="ctrl-btn">AP<span class="ctrl-btn-sublabel">√öhel</span></button>
            <button onclick="window.insertControllerToken('-')" class="ctrl-btn ctrl-btn-num">-</button>
            <button onclick="window.insertControllerToken('0')" class="ctrl-btn ctrl-btn-num">0</button>
            <button onclick="window.insertControllerToken('.')" class="ctrl-btn ctrl-btn-num">.</button>
            <button onclick="window.clearControllerInput()" class="ctrl-btn">C<span class="ctrl-btn-sublabel">Clear</span></button>
          </div>

          <!-- Row 5: Smƒõry, Sra≈æen√≠, Zaoblen√≠ -->
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 3px; margin-bottom: 6px">
            <button onclick="window.showControllerDirectionModal()" class="ctrl-btn ctrl-btn-action">üß≠<span class="ctrl-btn-sublabel">Smƒõry</span></button>
            <button onclick="window.showControllerLengthModal()" class="ctrl-btn ctrl-btn-action">üìè<span class="ctrl-btn-sublabel">D√©lka</span></button>
            <button onclick="window.insertControllerToken('Zaob ')" class="ctrl-btn ctrl-btn-action">‚óØ<span class="ctrl-btn-sublabel">Zaob</span></button>
          </div>

          <!-- Action Buttons -->
          <div style="margin-top: 6px">
            <button onclick="window.confirmControllerInput()" style="width: 100%; padding: 10px; background: #22c55e; border: none; border-radius: 6px; color: white; cursor: pointer; font-size: 14px; font-weight: bold">‚úì Potvrdit</button>
          </div>
        </div>

        <!-- Help Text -->
        <div style="margin-top: 12px; padding: 10px; background: #1a1a1a; border-radius: 6px; border-left: 3px solid #6ab0ff; font-size: 11px; color: #aaa">
          <strong style="color: #6ab0ff">üí° Tip:</strong> Pou≈æij <strong>G-k√≥dy</strong>: <code style="color: #90ee90">G0 X50 Z100</code> (bod), <code style="color: #90ee90">G1 X100</code> (ƒç√°ra), <code style="color: #90ee90">G2 R20</code> (oblouk)
        </div>
      </div>
    </div>
    <div id="directionModal" class="modal-overlay d-none">
      <div class="modal-window" style="max-width: 350px">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px">
          <h2 style="color: #6ab0ff; font-size: 18px; margin: 0">üß≠ Smƒõrov√© kreslen√≠</h2>
          <button onclick="window.closeDirectionModal()" style="background: transparent; border: none; color: #888; font-size: 20px; cursor: pointer">&times;</button>
        </div>

        <p style="color: #aaa; font-size: 12px; margin-bottom: 15px">Klikni na ≈°ipku, automaticky se vlo≈æ√≠ p≈ô√≠kaz do zad√°n√≠:</p>

        <!-- Direction Pad (8-way) -->
        <div style="display: grid; grid-template-columns: repeat(3, 80px); grid-template-rows: repeat(3, 80px); gap: 5px; justify-content: center">
          <!-- Row 1: ‚Üñ ‚Üë ‚Üó -->
          <button onclick="window.insertDirectionCommand('NW')" title="≈†ikmo vlevo nahoru (‚Üñ)" class="direction-btn">‚Üñ</button>
          <button onclick="window.insertDirectionCommand('N')" title="Nahoru (‚Üë)" class="direction-btn">‚Üë</button>
          <button onclick="window.insertDirectionCommand('NE')" title="≈†ikmo vpravo nahoru (‚Üó)" class="direction-btn">‚Üó</button>

          <!-- Row 2: ‚Üê ¬∑ ‚Üí -->
          <button onclick="window.insertDirectionCommand('W')" title="Doleva (‚Üê)" class="direction-btn">‚Üê</button>
          <div class="direction-center">‚óè</div>
          <button onclick="window.insertDirectionCommand('E')" title="Doprava (‚Üí)" class="direction-btn">‚Üí</button>

          <!-- Row 3: ‚Üô ‚Üì ‚Üò -->
          <button onclick="window.insertDirectionCommand('SW')" title="≈†ikmo vlevo dol≈Ø (‚Üô)" class="direction-btn">‚Üô</button>
          <button onclick="window.insertDirectionCommand('S')" title="Dol≈Ø (‚Üì)" class="direction-btn">‚Üì</button>
          <button onclick="window.insertDirectionCommand('SE')" title="≈†ikmo vpravo dol≈Ø (‚Üò)" class="direction-btn">‚Üò</button>
        </div>

        <div class="mt-15 text-center">
          <button onclick="window.closeDirectionModal()" class="btn-primary">Zav≈ô√≠t</button>
        </div>
      </div>
    </div>
    <div id="controllerHelpModal" class="modal-overlay d-none">
      <div class="modal-window modal-lg">
        <div class="modal-header">
          <h2 class="modal-header-title no-margin">‚ùì N√°povƒõda - Ovladaƒç</h2>
          <button onclick="window.closeControllerHelp()" class="modal-close-btn-simple">&times;</button>
        </div>

        <div class="help-section">
          <h3 class="help-title">üìê Z√°kladn√≠ p≈ô√≠kazy</h3>
          <div class="help-block">
            <div class="mb-8"><code class="help-code">X80 Z120</code> - Bod na sou≈ôadnic√≠ch X=80, Z=120</div>
            <div class="mb-8"><code class="help-code">G1 X100 Z200</code> - ƒå√°ra do bodu X=100, Z=200</div>
            <div class="mb-8"><code class="help-code">G0 X50</code> - Skok (bez ƒç√°ry) na X=50</div>
          </div>

          <h3 class="help-title">‚≠ï Kru≈ænice a oblouky</h3>
          <div class="help-block">
            <div class="mb-8"><code class="help-code">R50</code> - Kru≈ænice s polomƒõrem 50mm</div>
            <div class="mb-8"><code class="help-code">CR30</code> - Kru≈ænice s minim√°ln√≠m polomƒõrem</div>
            <div class="mb-8"><code class="help-code">G2 X100 Z150 R25</code> - Oblouk CW</div>
          </div>

          <h3 class="help-title">üìè Pol√°rn√≠ sou≈ôadnice</h3>
          <div class="help-block">
            <div class="mb-8"><code class="help-code">AP0 RP120</code> - ƒå√°ra √∫hel 0¬∞, d√©lka 120mm</div>
            <div class="mb-8"><code class="help-code">L50 A90</code> - D√©lka 50, √∫hel 90¬∞</div>
          </div>
        </div>
      </div>
    </div>

    <!-- QUICK INPUT MODAL - Kl√°vesnice pro CNC p≈ô√≠kazy -->
    <div id="quickInputModal" class="modal-overlay d-none">
      <div class="modal-window modal-md">
        <div class="modal-header">
          <h2 class="modal-header-title no-margin">‚å®Ô∏è Rychl√© zad√°n√≠ (CNC)</h2>
          <button onclick="window.closeQuickInput()" class="modal-close-btn-simple">&times;</button>
        </div>

        <!-- TEXT DISPLAY -->
        <textarea id="quickInputDisplay" class="qi-display" placeholder="Zde se zobrazuje zad√°n√≠..." readonly></textarea>

        <!-- ERROR DISPLAY -->
        <div id="quickInputError" class="qi-error"></div>

        <!-- KEYPAD GRID -->
        <div class="qi-grid">
          <!-- G-Codes -->
          <button onclick="window.insertToken('G90 ')" class="qi-btn qi-btn-gcode">G90<span class="ctrl-btn-sublabel">Abs</span></button>
          <button onclick="window.insertToken('G91 ')" class="qi-btn qi-btn-gcode">G91<span class="ctrl-btn-sublabel">P≈ô√≠r</span></button>
          <button onclick="window.insertToken('G0 ')" class="qi-btn qi-btn-gcode">G0<span class="ctrl-btn-sublabel">Bod</span></button>
          <button onclick="window.insertToken('G1 ')" class="qi-btn qi-btn-gcode">G1<span class="ctrl-btn-sublabel">P≈ô√≠mka</span></button>
          <button onclick="window.insertToken('G2 ')" class="qi-btn qi-btn-gcode">G2<span class="ctrl-btn-sublabel">CW</span></button>
          <button onclick="window.insertToken('G3 ')" class="qi-btn qi-btn-gcode">G3<span class="ctrl-btn-sublabel">CCW</span></button>

          <!-- Row 1: X, Z, 7, 8, 9, ; -->
          <button onclick="window.insertToken('X')" class="qi-btn">X<span class="ctrl-btn-sublabel">Osa</span></button>
          <button onclick="window.insertToken('Z')" class="qi-btn">Z<span class="ctrl-btn-sublabel">Osa</span></button>
          <button onclick="window.insertToken('7')" class="qi-btn">7</button>
          <button onclick="window.insertToken('8')" class="qi-btn">8</button>
          <button onclick="window.insertToken('9')" class="qi-btn">9</button>
          <button onclick="window.insertToken(';')" class="qi-btn">;</button>

          <!-- Row 2: R, D, 4, 5, 6, Space -->
          <button onclick="window.insertToken('R')" class="qi-btn">R<span class="ctrl-btn-sublabel">Polomƒõr</span></button>
          <button onclick="window.insertToken('D')" class="qi-btn">D<span class="ctrl-btn-sublabel">Pr≈Ømƒõr</span></button>
          <button onclick="window.insertToken('4')" class="qi-btn">4</button>
          <button onclick="window.insertToken('5')" class="qi-btn">5</button>
          <button onclick="window.insertToken('6')" class="qi-btn">6</button>
          <button onclick="window.insertToken(' ')" class="qi-btn">Mezera</button>

          <!-- Row 3: L, A, 1, 2, 3, ? -->
          <button onclick="window.insertToken('L')" class="qi-btn">L<span class="ctrl-btn-sublabel">D√©lka</span></button>
          <button onclick="window.insertToken('A')" class="qi-btn">A<span class="ctrl-btn-sublabel">√öhel</span></button>
          <button onclick="window.insertToken('1')" class="qi-btn">1</button>
          <button onclick="window.insertToken('2')" class="qi-btn">2</button>
          <button onclick="window.insertToken('3')" class="qi-btn">3</button>
          <button onclick="window.showQuickInputHelp()" style="padding: 6px; background: #444; border: 1px solid #666; border-radius: 4px; color: #aaa; cursor: pointer; font-size: 9px">?<span class="ctrl-btn-sublabel">N√°povƒõda</span></button>

          <!-- Row 4: RP, AP, -, 0, ., ‚å´ -->
          <button onclick="window.insertToken('RP ')" class="qi-btn">RP<span class="ctrl-btn-sublabel">Pol. polomƒõr</span></button>
          <button onclick="window.insertToken('AP ')" class="qi-btn">AP<span class="ctrl-btn-sublabel">Pol. √∫hel</span></button>
          <button onclick="window.insertToken('-')" class="qi-btn">-</button>
          <button onclick="window.insertToken('0')" class="qi-btn">0</button>
          <button onclick="window.insertToken('.')" class="qi-btn">.</button>
          <button onclick="window.backspaceToken()" style="padding: 6px; background: #c53030; border: 1px solid #e53e3e; border-radius: 4px; color: white; cursor: pointer; font-size: 9px">‚å´</button>

          <!-- Row 5: Smƒõry, Sra≈æen√≠, Zaoblen√≠, V√Ωbƒõr, Vlo≈æit -->
          <button onclick="window.showDirectionModal()" class="qi-btn qi-btn-gcode">üß≠<span class="ctrl-btn-sublabel">Smƒõry</span></button>
          <button onclick="window.openLengthModal()" class="qi-btn qi-btn-gcode">üìè<span class="ctrl-btn-sublabel">D√©lka</span></button>
          <button onclick="window.insertToken('Sra≈æ ')" class="qi-btn">Sra≈æ<span class="ctrl-btn-sublabel">Sra≈æen√≠</span></button>
          <button onclick="window.insertToken('Zaob ')" class="qi-btn">Zaob<span class="ctrl-btn-sublabel">Zaoblen√≠</span></button>
          <button onclick="window.insertToken('V√Ωbƒõr ')" class="qi-btn">V√Ωbƒõr<span class="ctrl-btn-sublabel">Vybran√©</span></button>
          <button onclick="window.confirmQuickInput()" style="padding: 6px; background: #22c55e; border: 1px solid #4ade80; border-radius: 4px; color: white; cursor: pointer; font-size: 9px; grid-column: span 2">‚úì Vlo≈æit<span class="ctrl-btn-sublabel">do chatu</span></button>
        </div>
      </div>
    </div>

    <!-- DIRECTION MODAL - V√Ωbƒõr smƒõru pro useƒçky -->
    <div id="directionModal" class="modal-overlay d-none">
      <div class="modal-window" style="max-width: 280px">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px">
          <h2 style="color: #6ab0ff; font-size: 16px; margin: 0">üß≠ Smƒõr useƒçky</h2>
          <button onclick="window.closeDirectionModal()" style="background: transparent; border: none; color: #888; font-size: 20px; cursor: pointer">&times;</button>
        </div>
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px">
          <button onclick="window.insertDirection(45)" style="padding: 8px; background: #2d5a8f; border: 1px solid #5a7aaf; border-radius: 4px; color: #90cdf4; cursor: pointer; font-size: 16px">‚Üñ</button>
          <button onclick="window.insertDirection(90)" style="padding: 8px; background: #2d5a8f; border: 1px solid #5a7aaf; border-radius: 4px; color: #90cdf4; cursor: pointer; font-size: 16px">‚Üë</button>
          <button onclick="window.insertDirection(135)" style="padding: 8px; background: #2d5a8f; border: 1px solid #5a7aaf; border-radius: 4px; color: #90cdf4; cursor: pointer; font-size: 16px">‚Üó</button>

          <button onclick="window.insertDirection(180)" style="padding: 8px; background: #2d5a8f; border: 1px solid #5a7aaf; border-radius: 4px; color: #90cdf4; cursor: pointer; font-size: 16px">‚Üê</button>
          <button onclick="window.closeDirectionModal()" style="padding: 8px; background: #333; border: 1px solid #444; border-radius: 4px; color: #888; cursor: pointer; font-size: 14px">‚óè</button>
          <button onclick="window.insertDirection(0)" style="padding: 8px; background: #2d5a8f; border: 1px solid #5a7aaf; border-radius: 4px; color: #90cdf4; cursor: pointer; font-size: 16px">‚Üí</button>

          <button onclick="window.insertDirection(225)" style="padding: 8px; background: #2d5a8f; border: 1px solid #5a7aaf; border-radius: 4px; color: #90cdf4; cursor: pointer; font-size: 16px">‚Üô</button>
          <button onclick="window.insertDirection(270)" style="padding: 8px; background: #2d5a8f; border: 1px solid #5a7aaf; border-radius: 4px; color: #90cdf4; cursor: pointer; font-size: 16px">‚Üì</button>
          <button onclick="window.insertDirection(315)" style="padding: 8px; background: #2d5a8f; border: 1px solid #5a7aaf; border-radius: 4px; color: #90cdf4; cursor: pointer; font-size: 16px">‚Üò</button>
        </div>
      </div>
    </div>

    <!-- LENGTH MODAL - Zad√°n√≠ d√©lky useƒçky -->
    <div id="lengthModal" class="modal-overlay d-none">
      <div class="modal-window" style="max-width: 300px">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px">
          <h2 style="color: #6ab0ff; font-size: 16px; margin: 0">üìè D√©lka useƒçky</h2>
          <button onclick="window.closeLengthModal()" style="background: transparent; border: none; color: #888; font-size: 20px; cursor: pointer">&times;</button>
        </div>
        <input id="lengthInput" type="number" placeholder="Zadej d√©lku..." style="width: 100%; padding: 10px; background: #111; border: 1px solid #444; color: #90ee90; border-radius: 4px; font-family: monospace; margin-bottom: 10px"/>
        <div style="display: flex; gap: 8px">
          <button onclick="window.insertLengthToken('L')" style="flex: 1; padding: 8px; background: #333; border: 1px solid #444; border-radius: 4px; color: white; cursor: pointer">L (D√©lka)</button>
          <button onclick="window.insertLengthToken('RP')" style="flex: 1; padding: 8px; background: #333; border: 1px solid #444; border-radius: 4px; color: white; cursor: pointer">RP (Pol. polomƒõr)</button>
        </div>
        <button onclick="window.confirmLength()" style="width: 100%; padding: 8px; margin-top: 8px; background: #22c55e; border: 1px solid #4ade80; border-radius: 4px; color: white; cursor: pointer; font-weight: bold">‚úì Vlo≈æit</button>
      </div>
    </div>

    <!-- AI TEST SUITE MODAL -->
    <div id="aiTestModal" class="modal-overlay d-none">
      <div class="modal-window" style="max-width: 700px; max-height: 85vh; overflow-y: auto">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #3a7bc8; padding-bottom: 10px">
          <h2 style="color: #6ab0ff; font-size: 18px; margin: 0">üß™ AI TEST SUITE</h2>
          <button onclick="window.closeAITestModal()" style="background: transparent; border: none; color: #888; font-size: 20px; cursor: pointer">&times;</button>
        </div>

        <div id="aiTestContent" style="margin-bottom: 20px">
          <!-- Obsah se vypln√≠ dynamicky z JavaScriptu -->
        </div>

        <div style="display: flex; gap: 10px; justify-content: center; border-top: 1px solid #333; padding-top: 15px">
          <button onclick="window.closeAITestModal()" style="padding: 10px 20px; background: #444; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px">‚ùå Zru≈°it</button>
        </div>
      </div>
    </div>

  </body>
</html>
```
